<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="\[\] Pretty much entirely based on this paper: Electromagnetic extension of the Dory– Guest–Harris instability as a benchmark for Vlasov–Maxwell continuum kinetic simulations of magnetized plasmas
Closed Integral Form of Dispersion Relation # Iman&rsquo;s done a great job deriving a closed-form integral representation of the dispersion relation for the Dory-Guest-Harris instability. The trick to computing solutions to the dispersion relation is in getting all of the the normalization correct and computing the correct quadrature across both integrals (over $v_\perp$ and $\theta$)."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Electrodynamic Dory-Guest-Harris Instability"><meta property="og:description" content="\[\] Pretty much entirely based on this paper: Electromagnetic extension of the Dory– Guest–Harris instability as a benchmark for Vlasov–Maxwell continuum kinetic simulations of magnetized plasmas
Closed Integral Form of Dispersion Relation # Iman&rsquo;s done a great job deriving a closed-form integral representation of the dispersion relation for the Dory-Guest-Harris instability. The trick to computing solutions to the dispersion relation is in getting all of the the normalization correct and computing the correct quadrature across both integrals (over $v_\perp$ and $\theta$)."><meta property="og:type" content="article"><meta property="og:url" content="https://peppyhare.github.io/r/notes/research/dgh-datta/"><meta property="article:section" content="notes"><meta property="article:modified_time" content="2023-05-26T15:52:23-07:00"><title>Electrodynamic Dory-Guest-Harris Instability | My Notes</title><link rel=manifest href=/r/manifest.json><link rel=icon href=/r/favicon.png type=image/x-icon><link rel=stylesheet href=/r/book.min.3c7f42c913e8864f817f813e5a43db72a7e65e5f1117470753a8da987023ae25.css integrity="sha256-PH9CyRPohk+Bf4E+WkPbcqfmXl8RF0cHU6jamHAjriU=" crossorigin=anonymous><script defer src=/r/flexsearch.min.js></script>
<script defer src=/r/en.search.min.14db7eedc7c703ec544d1c1e7c9e4b3d0fcf1707e3da9189dfe7e15cf1187ca1.js integrity="sha256-FNt+7cfHA+xUTRwefJ5LPQ/PFwfj2pGJ3+fhXPEYfKE=" crossorigin=anonymous></script>
<script defer src=/r/sw.min.9e3a83f0b071ebe0141a16a33db93faadb2bdf712473a218febeed35ed243c08.js integrity="sha256-njqD8LBx6+AUGhajPbk/qtsr33Ekc6IY/r7tNe0kPAg=" crossorigin=anonymous></script>
<link rel=preload href=/r/katex/fonts/KaTeX_Main-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/katex/fonts/KaTeX_Main-Bold.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/katex/fonts/KaTeX_Main-Italic.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/katex/fonts/KaTeX_Math-Italic.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/katex/fonts/KaTeX_Size2-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/katex/fonts/KaTeX_Size3-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/fonts/roboto-v27-latin-regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/fonts/roboto-v27-latin-700.woff2 as=font type=font/woff2 crossorigin=anonymous></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/r/><span>My Notes</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/r/svg/translate.svg class=book-icon alt=Languages>
English</a></label><ul></ul></li></ul><ul><li class=book-section-flat><ul><li class=book-section-flat><input type=checkbox id=section-3c2351b6c36eb8737d2b3aab84ebe41a class=toggle>
<label for=section-3c2351b6c36eb8737d2b3aab84ebe41a class="flex justify-between"><a href=/r/notes/UWAA545/ class="navbutton
book-collapse-section">Computational Methods For Plasmas</a></label><ul><li><a href=/r/notes/UWAA545/01-syllabus/ class=navbutton>Syllabus</a></li><li><a href=/r/notes/UWAA545/02-plasma-models/ class=navbutton>Plasma Models</a></li><li><a href=/r/notes/UWAA545/03-pic-method/ class=navbutton>Particle in Cell Model</a></li><li><a href=/r/notes/UWAA545/04-pic-example/ class=navbutton>PIC - Example Implementation</a></li><li><a href=/r/notes/UWAA545/05-electrodynamic-pic/ class=navbutton>Multidimensional Electrodynamic PIC</a></li><li><a href=/r/notes/UWAA545/06-fluid-models/ class=navbutton>Fluid Models for Plasmas</a></li><li><a href=/r/notes/UWAA545/07-finite-difference-models/ class=navbutton>Finite Difference Methods for MHD</a></li><li><a href=/r/notes/UWAA545/08-mhd-equilibrium/ class=navbutton>MHD Equilibrium Calculations</a></li><li><a href=/r/notes/UWAA545/formulary/ class=navbutton>Formulary</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-6349dd4237c5b36ce5c3738b93bc5885 class=toggle>
<label for=section-6349dd4237c5b36ce5c3738b93bc5885 class="flex justify-between"><a href=/r/notes/UWAA560/ class="navbutton
book-collapse-section">Plasma Diagnostics</a></label><ul><li><a href=/r/notes/UWAA560/01-syllabus/ class=navbutton>Syllabus</a></li><li><a href=/r/notes/UWAA560/02-diagnostic-considerations/ class=navbutton>General Diagnostic Considerations</a></li><li><a href=/r/notes/UWAA560/03-magnetic-field-diagnostics/ class=navbutton>Magnetic Field Diagnostics</a></li><li><a href=/r/notes/UWAA560/04-electrostatic-diagnostics/ class=navbutton>Electrostatic Diagnostics</a></li><li><a href=/r/notes/UWAA560/05-index-of-refraction-measurements/ class=navbutton>Index of Refraction Measurements</a></li><li><a href=/r/notes/UWAA560/06-spectroscopic-measurements/ class=navbutton>Spectroscopic Measurements</a></li><li><a href=/r/notes/UWAA560/90-student-lectures/ class=navbutton>Student Lectures</a></li><li><a href=/r/notes/UWAA560/91-zeeman-spectroscopy/ class=navbutton>My class lecture</a></li><li><a href=/r/notes/UWAA560/formulary/ class=navbutton>Formulary</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-edf338bf880234e7aba93d04934ebde0 class=toggle>
<label for=section-edf338bf880234e7aba93d04934ebde0 class="flex justify-between"><a href=/r/notes/UWAA558/ class="navbutton
book-collapse-section">MHD Theory</a></label><ul><li><a href=/r/notes/UWAA558/01-syllabus/ class=navbutton>Syllabus</a></li><li><a href=/r/notes/UWAA558/02-plasma-models/ class=navbutton>Plasma Models</a></li><li><a href=/r/notes/UWAA558/03-plasma-fluid-model/ class=navbutton>Plasma Fluid Model</a></li><li><a href=/r/notes/UWAA558/04-two-fluid-plasma-model/ class=navbutton>Two-Fluid Plasma Model</a></li><li><a href=/r/notes/UWAA558/05-mhd-model/ class=navbutton>Magnetohydrodynamic (MHD) Model</a></li><li><a href=/r/notes/UWAA558/06-boundary-conditions/ class=navbutton>Boundary Conditions</a></li><li><a href=/r/notes/UWAA558/07-equilibrium-for-fusion/ class=navbutton>Equilibrium for Fusion</a></li><li><a href=/r/notes/UWAA558/08-1d-equilibria/ class=navbutton>1-D Equilibria</a></li><li><a href=/r/notes/UWAA558/09-2d-equilibria/ class=navbutton>2D Equilibria</a></li><li><a href=/r/notes/UWAA558/10-equilibrium-of-3d-configurations/ class=navbutton>Equilibrium of 3D Configurations</a></li><li><a href=/r/notes/UWAA558/11-mhd-stability/ class=navbutton>MHD Stability</a></li><li><a href=/r/notes/UWAA558/formulary/ class=navbutton>Formulary</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-0ab4cc33a17dbfeaac89afca6a70923e class=toggle checked>
<label for=section-0ab4cc33a17dbfeaac89afca6a70923e class="flex justify-between"><a href=/r/notes/research/ class="navbutton
book-collapse-section">Research Notes</a></label><ul><li><a href=/r/notes/research/dgh-datta/ class="active navbutton">Electrodynamic Dory-Guest-Harris Instability</a></li><li><a href=/r/notes/research/warpxm-101/ class=navbutton>Getting Started with WARPXM</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-413f74fd9b5926250a41b61f37ddacc6 class=toggle>
<label for=section-413f74fd9b5926250a41b61f37ddacc6 class="flex justify-between"><a href=/r/notes/UWAA557/ class="navbutton
book-collapse-section">Physics of Fusion Plasmas</a></label><ul><li><a href=/r/notes/UWAA557/ch10-0/ class=navbutton>Rules of thumb</a></li><li><a href=/r/notes/UWAA557/ch10-1/ class=navbutton>Statistical Mechanics</a></li><li><a href=/r/notes/UWAA557/ch10-2/ class=navbutton>Review of E&amp;M</a></li><li><a href=/r/notes/UWAA557/ch10-3/ class=navbutton>Lagrange Multipliers</a></li><li><a href=/r/notes/UWAA557/ch11-1/ class=navbutton>Wall-supported Plasma</a></li><li><a href=/r/notes/UWAA557/ch11-2/ class=navbutton>Collisions</a></li><li><a href=/r/notes/UWAA557/ch11-3/ class=navbutton>Oscillations</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-f5aa9ed14dd55f47a51954bafbe42c68 class=toggle>
<label for=section-f5aa9ed14dd55f47a51954bafbe42c68 class="flex justify-between"><a href=/r/notes/UWAA543/ class="navbutton
book-collapse-section">Computational CFD</a></label><ul><li><a href=/r/notes/UWAA543/ch20-1/ class=navbutton>Introduction to Computational CFD</a></li><li><a href=/r/notes/UWAA543/ch20-2/ class=navbutton>Governing Equations</a></li><li><a href=/r/notes/UWAA543/ch20-3/ class=navbutton>Reduced Models</a></li><li><a href=/r/notes/UWAA543/ch20-4/ class=navbutton>Equation Types</a></li><li><a href=/r/notes/UWAA543/ch20-5/ class=navbutton>Panel Method</a></li><li><a href=/r/notes/UWAA543/ch21-1/ class=navbutton>Finite Difference Algorithms</a></li><li><a href=/r/notes/UWAA543/ch21-2/ class=navbutton>Explicit Finite Difference Algorithms</a></li><li><a href=/r/notes/UWAA543/ch21-3/ class=navbutton>Finite Difference and Finite Volume Methods</a></li><li><a href=/r/notes/UWAA543/ch21-4/ class=navbutton>Implicit Algorithms</a></li><li><a href=/r/notes/UWAA543/ch21-5/ class=navbutton>Numerical Boundary Conditions</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-fec96caaff8d6393621cb5c836aaffe6 class=toggle>
<label for=section-fec96caaff8d6393621cb5c836aaffe6 class="flex justify-between"><a href=/r/notes/UWAA556/ class="navbutton
book-collapse-section">Plasma Waves</a></label><ul><li><a href=/r/notes/UWAA556/ch01-1/ class=navbutton>Mathematical review</a></li><li><a href=/r/notes/UWAA556/ch02-1/ class=navbutton>Plasma Waves in General Dielectric Media</a></li><li><a href=/r/notes/UWAA556/ch02-2/ class=navbutton>Wave Properties in Cold Unmagnetized Plasma</a></li><li><a href=/r/notes/UWAA556/ch02-3/ class=navbutton>Cold Magnetized Plasma Dispersion Relation</a></li><li><a href=/r/notes/UWAA556/ch02-4/ class=navbutton>The CMA Diagram</a></li><li><a href=/r/notes/UWAA556/ch03-1/ class=navbutton>Introduction to Kinetic Theory</a></li><li><a href=/r/notes/UWAA556/ch03-2/ class=navbutton>Landau Damping</a></li><li><a href=/r/notes/UWAA556/ch03-3/ class=navbutton>Waves in Hot Magnetized Plasma</a></li><li><a href=/r/notes/UWAA556/ch04-1/ class=navbutton>Fluid stuff</a></li><li><a href=/r/notes/UWAA556/ch04-2/ class=navbutton>Quasi-Linear Theory</a></li><li><a href=/r/notes/UWAA556/ch05-1/ class=navbutton>Diffusion and Resistivity</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-8fb1297aabc80ae7754972056ff59a2d class=toggle>
<label for=section-8fb1297aabc80ae7754972056ff59a2d class="flex justify-between"><a href=/r/notes/problems/ class="navbutton
book-collapse-section">Worked Problems</a></label><ul><li><a href=/r/notes/problems/gurnett/ch02/ class=navbutton>Characteristic Parameters of a Plasma</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-3cae707fb8713119044de8d3ecbe7266 class=toggle>
<label for=section-3cae707fb8713119044de8d3ecbe7266 class="flex justify-between"><a role=button class="navbutton
book-collapse-section">Scratch</a></label><ul><li><a href=/r/notes/scratch/colors/ class=navbutton>Adding Color</a></li><li><a href=/r/notes/scratch/crews2018/ class=navbutton>Crews (2018)</a></li><li><a href=/r/notes/scratch/datta2021/ class=navbutton>Datta (2021)</a></li><li><a href=/r/notes/scratch/drawing/ class=navbutton>Drawing Diagrams</a></li><li><a href=/r/notes/scratch/goedbloed/ class=navbutton>Goedbloed (2019)</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-ee5e070eb25b63f2c377d750d37f67ae class=toggle>
<label for=section-ee5e070eb25b63f2c377d750d37f67ae class="flex justify-between"><a href=/r/notes/griffiths/ class="navbutton
book-collapse-section">Griffiths Introduction to Electrodynamics</a></label><ul><li><a href=/r/notes/griffiths/ch1-1/ class=navbutton>Vector Algebra</a></li><li><a href=/r/notes/griffiths/ch1-2/ class=navbutton>Differential Calculus</a></li><li><a href=/r/notes/griffiths/ch1-3/ class=navbutton>Integral Calculus</a></li><li><a href=/r/notes/griffiths/ch1-4/ class=navbutton>Curvilinear Coordinates</a></li><li><a href=/r/notes/griffiths/ch1-5/ class=navbutton>The Dirac Delta Function</a></li><li><a href=/r/notes/griffiths/ch1-6/ class=navbutton>The Theory of Vector Fields</a></li><li><a href=/r/notes/griffiths/ch2-1/ class=navbutton>The Electric Field</a></li><li><a href=/r/notes/griffiths/ch2-2/ class=navbutton>Divergence and Curl of Electrostatic Fields</a></li><li><a href=/r/notes/griffiths/ch2-3/ class=navbutton>Electric Potential</a></li><li><a href=/r/notes/griffiths/ch2-4/ class=navbutton>Work and Energy in Electrostatics</a></li><li><a href=/r/notes/griffiths/ch2-5/ class=navbutton>Conductors</a></li><li><a href=/r/notes/griffiths/ch3-1/ class=navbutton>Laplace's Equation</a></li><li><a href=/r/notes/griffiths/ch3-2/ class=navbutton>The Method of Images</a></li><li><a href=/r/notes/griffiths/ch3-3/ class=navbutton>Separation of Variables</a></li><li><a href=/r/notes/griffiths/ch3-4/ class=navbutton>Multipole Expansion</a></li><li><a href=/r/notes/griffiths/ch4-1/ class=navbutton>Polarization</a></li><li><a href=/r/notes/griffiths/ch4-2/ class=navbutton>The Field of a Polarized Object</a></li><li><a href=/r/notes/griffiths/ch4-3/ class=navbutton>The Electric Displacement</a></li><li><a href=/r/notes/griffiths/ch4-4/ class=navbutton>The Linear Dielectrics</a></li><li><a href=/r/notes/griffiths/ch5-1/ class=navbutton>The Lorentz Force Law</a></li><li><a href=/r/notes/griffiths/ch5-2/ class=navbutton>The Biot-Savart Law</a></li><li><a href=/r/notes/griffiths/ch5-3/ class=navbutton>The Divergence and Curl of B</a></li><li><a href=/r/notes/griffiths/ch5-4/ class=navbutton>Magnetic Vector Potential</a></li><li><a href=/r/notes/griffiths/ch6-1/ class=navbutton>Magnetization</a></li><li><a href=/r/notes/griffiths/ch6-2/ class=navbutton>The Field of a Magnetized Object</a></li><li><a href=/r/notes/griffiths/ch6-3/ class=navbutton>The Auxiliary Field H</a></li><li><a href=/r/notes/griffiths/ch6-4/ class=navbutton>Linear and Nonlinear Media</a></li><li><a href=/r/notes/griffiths/ch7-1/ class=navbutton>Electromotive Force</a></li><li><a href=/r/notes/griffiths/ch7-2/ class=navbutton>Electromagnetic Induction</a></li><li><a href=/r/notes/griffiths/ch7-3/ class=navbutton>Maxwell's Equations</a></li><li><a href=/r/notes/griffiths/ch8-0/ class=navbutton>Phys 544 Introduction</a></li><li><a href=/r/notes/griffiths/ch8-1/ class=navbutton>Charge and Energy</a></li><li><a href=/r/notes/griffiths/ch8-2/ class=navbutton>Momentum</a></li><li><a href=/r/notes/griffiths/ch9-1/ class=navbutton>Electromagnetic Waves in One Dimension</a></li><li><a href=/r/notes/griffiths/ch9-2/ class=navbutton>Wave Equation for E and B</a></li><li><a href=/r/notes/griffiths/ch9-3/ class=navbutton>Electromagnetic Waves in Matter</a></li><li><a href=/r/notes/griffiths/ch9-4/ class=navbutton>Electromagnetic Waves in Conductors</a></li><li><a href=/r/notes/griffiths/ch9-5/ class=navbutton>Guided Waves</a></li><li><a href=/r/notes/griffiths/ch10-1/ class=navbutton>Scalar and Vector Potentials</a></li><li><a href=/r/notes/griffiths/ch10-2/ class=navbutton>Retarded Potentials</a></li><li><a href=/r/notes/griffiths/ch10-3/ class=navbutton>Point Charges</a></li><li><a href=/r/notes/griffiths/ch11-1/ class=navbutton>Dipole Radiation</a></li><li><a href=/r/notes/griffiths/problems-ch3/ class=navbutton>Solved Problems Ch3</a></li><li><a href=/r/notes/griffiths/problems-ch5/ class=navbutton>Solved Problems Ch5</a></li><li><a href=/r/notes/griffiths/problems-ch7/ class=navbutton>Solved Problems Ch7</a></li><li><a href=/r/notes/griffiths/problems-ch9/ class=navbutton>Solved Problems Ch9</a></li></ul></li></ul></li></ul><ul class=book-menu-hugo><li><a href=https://github.com/Peppyhare/r target=_blank rel=noopener>Github</a></li><li><a href=https://themes.gohugo.io/hugo-book/ target=_blank rel=noopener>Hugo Themes</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/r/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Electrodynamic Dory-Guest-Harris Instability</strong>
<label for=toc-control></label></div></header><article class=markdown><link rel=stylesheet href=/r/katex/katex.min.css><script defer src=/r/katex/katex.min.js></script>
<script defer src=/r/katex/auto-render.min.js onload=loadKatex()></script><span>
\[\]</span>
<script>function loadKatex(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1,trust:e=>["\\htmlId","\\href"].includes(e.command),macros:{"\\lcm":"\\mathop{\\mathrm{lcm}}","\\sen":"\\text{sen}\\,","\\dd":"\\mathop{\\mathrm{d} #1}","\\abs":`\\lvert #1 \\rvert`,"\\dd":"\\text{d}","\\cross":"\\times","\\pdv":"\\frac{\\partial #1}{\\partial #2}","\\curl":`\\nabla \\cross #1`,"\\vu":"\\mathbf{\\hat{#1}}","\\vdot":"\\dot","\\div":`\\nabla \\cdot #1`,"\\grad":`\\nabla`,"\\dv":"\\frac{d\\,#1}{d\\,#2}","\\gr":"\\gamma","\\vec":"\\mathbf{#1}","\\tagl":"\\tag{#1}","\\eqref":"(#1)","\\laplacian":`\\mathbf{\\nabla ^2}`,"\\label":"{}","\\negadelta":`\\nabla`,"\\eqref":"\\href{###1}{(\\text{#1})}","\\ref":"\\href{###1}{\\text{#1}}","\\label":"\\htmlId{#1}{}"}})}</script><p>Pretty much entirely based on this paper:
<a href=https://doi.org/10.1063/5.0057230>Electromagnetic extension of the Dory– Guest–Harris instability as a benchmark for Vlasov–Maxwell continuum kinetic simulations of magnetized plasmas</a></p><h1 id=closed-integral-form-of-dispersion-relation>Closed Integral Form of Dispersion Relation
<a class=anchor href=#closed-integral-form-of-dispersion-relation>#</a></h1><p>Iman&rsquo;s done a great job deriving a closed-form integral representation of the dispersion relation for the Dory-Guest-Harris instability. The trick to computing solutions to the dispersion relation is in getting all of the the normalization correct and computing the correct quadrature across both integrals (over $v_\perp$ and $\theta$).</p><p>The DGH dispersion relation is derived by perturbing Vlasov-Maxwell system about a spatially uniform equilibrium state \( f_s ^0 (v) \) in a uniform magnetic field \( B^0 \), leading to equilibrium cyclotron motion. We linearize the Vlasov-Maxwell system and analyze the equilibrium response.</p><p>Let \( B_0 \) be in the \( \hat{z} \) direction. We work in a cylindrical coordinate system such that</p><p>$$
\vec v = v_\perp \cos \phi \hat{x} + v_\perp \sin \phi \hat{y} + v_\parallel \hat{z}
$$</p><p>Without loss of generality, we rotate the coordinate frame such that</p><p>$$
\vec k = k_\perp \hat{x} + k_\parallel \hat{z}
$$</p><p>The \( v_\parallel \) component de-couples, and we are not interested, so let \(v_\parallel = 0\). Would need to be re-introduced for e.g. 2D3V or 3D3V situation, but we will only consider 1D2V here.</p><p>After some hard-fought applied mathematics, we get the electromagnetic dispersion relation as</p><p>$$
D(\omega, k_\perp) = K_{11} \left( K_{22} - \frac{(\omega_p \tau)^2 k_\perp ^2}{(\omega_c \tau)^2 \omega ^2} \right) - K_{12} K_{21}
$$</p><p>where</p><p>$$
K_{11} = 1 + \chi_{11}
$$</p><p>$$
K_{12} = \chi_{12}
$$</p><p>$$
K_{21} = \chi_{21}
$$</p><p>$$
K_{22} = 1 + \chi_{22}
$$</p><span>\[\chi = - \frac{2 \pi (\omega_p \tau)^2}{\omega (\omega_c \tau)} \sum_s \frac{\omega_{p, s} ^2}{\omega_{c, s}} \sum_{n = - \infty}^{\infty} \int_0 ^{\infty} \frac{\partial F_s ^0}{\partial v_\perp} \begin{bmatrix} \frac{n^2}{\beta_s ^2} J_n ^2 (\beta_s) & i \frac{n}{\beta_s} J_n (\beta_s) J_n ^\prime (\beta_s) \\\\ - i \frac{n}{\beta_s} J_n(\beta_s) J_n ^\prime(\beta_s) & J_n ^\prime (\beta_s) J_n ^\prime (\beta_s) \end{bmatrix} \frac{v_\perp ^2}{n - \alpha _s} \, d v_\perp\]</span>
<script>function loadKatex(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1,trust:e=>["\\htmlId","\\href"].includes(e.command),macros:{"\\lcm":"\\mathop{\\mathrm{lcm}}","\\sen":"\\text{sen}\\,","\\dd":"\\mathop{\\mathrm{d} #1}","\\abs":`\\lvert #1 \\rvert`,"\\dd":"\\text{d}","\\cross":"\\times","\\pdv":"\\frac{\\partial #1}{\\partial #2}","\\curl":`\\nabla \\cross #1`,"\\vu":"\\mathbf{\\hat{#1}}","\\vdot":"\\dot","\\div":`\\nabla \\cdot #1`,"\\grad":`\\nabla`,"\\dv":"\\frac{d\\,#1}{d\\,#2}","\\gr":"\\gamma","\\vec":"\\mathbf{#1}","\\tagl":"\\tag{#1}","\\eqref":"(#1)","\\laplacian":`\\mathbf{\\nabla ^2}`,"\\label":"{}","\\negadelta":`\\nabla`,"\\eqref":"\\href{###1}{(\\text{#1})}","\\ref":"\\href{###1}{\\text{#1}}","\\label":"\\htmlId{#1}{}"}})}</script><p>$$
\alpha _s \equiv \frac{\omega}{(\omega _c \tau) \omega _{c, s}}
$$</p><p>$$
\beta_s \equiv \frac{k_\perp v_\perp}{(\omega_c \tau) \omega_{c, s}}
$$</p><p>$$
F_s ^0 \equiv \frac{f_s ^0}{n_s}
$$</p><p>$$
\omega_{p, s}^2 \equiv \frac{Z_s ^2 n_s }{A_s}
$$</p><p>$$
\omega_{c, s} \equiv \frac{Z_s}{A_s} B^0
$$</p><p>Manipulation using Lerche-Newberger sum rule, we can get</p><span>\[\chi = -\frac{2 \pi (\omega_p \tau)^2}{\omega (\omega_c \tau)} \sum_s \frac{\omega_{p, s}^2}{\omega_{c, s}} \int_0 ^\infty \frac{\partial F_s ^0 }{\partial v_\perp} \begin{bmatrix} \frac{\alpha_s}{\beta_s ^2} (1 - Q_s) & - \frac{i}{2 \beta_s} Q_s ^\prime \\ \frac{i}{2 \beta_s} Q_s ^\prime & - \left( \frac{\pi}{\sin (\pi \alpha_s)} J_{- \alpha_s} ^\prime (\beta_s) J_{\alpha_s} ^\prime (\beta_s) + \frac{\alpha_s}{\beta_s ^2} \right) \end{bmatrix} v_\perp ^2 \, d v_\perp\]</span>
<script>function loadKatex(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1,trust:e=>["\\htmlId","\\href"].includes(e.command),macros:{"\\lcm":"\\mathop{\\mathrm{lcm}}","\\sen":"\\text{sen}\\,","\\dd":"\\mathop{\\mathrm{d} #1}","\\abs":`\\lvert #1 \\rvert`,"\\dd":"\\text{d}","\\cross":"\\times","\\pdv":"\\frac{\\partial #1}{\\partial #2}","\\curl":`\\nabla \\cross #1`,"\\vu":"\\mathbf{\\hat{#1}}","\\vdot":"\\dot","\\div":`\\nabla \\cdot #1`,"\\grad":`\\nabla`,"\\dv":"\\frac{d\\,#1}{d\\,#2}","\\gr":"\\gamma","\\vec":"\\mathbf{#1}","\\tagl":"\\tag{#1}","\\eqref":"(#1)","\\laplacian":`\\mathbf{\\nabla ^2}`,"\\label":"{}","\\negadelta":`\\nabla`,"\\eqref":"\\href{###1}{(\\text{#1})}","\\ref":"\\href{###1}{\\text{#1}}","\\label":"\\htmlId{#1}{}"}})}</script><p>where</p><p>$$
Q_s \equiv \frac{\pi \alpha_s}{\sin (\pi \alpha_s)} J_{- \alpha_s }(\beta_s) J_{\alpha_s}(\beta_s)
$$</p><p>$$
Q_s ^\prime \equiv \frac{\pi \alpha_s}{\sin (\pi \alpha_s)} \frac{\partial}{\partial \beta_s} \left[ J_{- \alpha_s}(\beta_s) J_{\alpha_s}(\beta_s) \right]
$$</p><p>We can re-cast the Bessel function products in terms of integrals of real low-order Bessel functions:</p><p>$$
J_{- \alpha_s}(\beta) J_{\alpha_s}(\beta) = \frac{2}{\pi} \int_0 ^{\pi / 2} J_0 (2 \beta \cos \theta) \cos (2 \alpha_s \theta) d \theta
$$</p><p>$$
\frac{\partial}{\partial \beta} [J_{-\alpha_s} (\beta) J_{\alpha_s} (\beta)] = - \frac{4}{\pi} \int_0 ^{\pi / 2} J_1 (2 \beta \cos \theta) \cos \theta \cos (2 \alpha_s \theta) d \theta
$$</p><p>$$
J^\prime _{- \alpha_s} (\beta) J^\prime _{\alpha_s} (\beta_s) = \frac{1}{\pi} \left[ \int_0 ^{\pi / 2} \cos (2 \alpha_s \theta) [J_2 (2 \beta \cos \theta) - J_0(2 \beta \cos \theta) \cos (2 \theta)] d \theta - \frac{\alpha_s}{\beta^2} \sin (\pi \alpha_s)\right]
$$</p><p>We are looking at a single-species picture, and we choose electrons. That means that</p><p>$$
A_s = 1
$$
$$
Z_s = -1
$$
$$
n = 1
$$</p><p>We choose (the cases in
<a href=https://doi.org/10.1016/j.jcp.2014.08.014%29>https://doi.org/10.1016/j.jcp.2014.08.014)</a>:</p><p>$$
B^0 = 1
$$
$$
v_\perp ^0 = \sqrt{2}
$$
$$
f^0 (v_\perp) \equiv \frac{1}{\pi \alpha_\perp ^2 j!} \left(\frac{v_\perp ^2}{\alpha_\perp ^2} \right)^j e^{- v_\perp ^2 / \alpha_\perp ^2}
$$</p><h3 id=things-i-need-for-integration>Things I need for integration:
<a class=anchor href=#things-i-need-for-integration>#</a></h3><p>$$
(\omega_p \tau) = 1
$$
$$
(\omega_c \tau) = (\omega_p / \omega_c)^{-1}
$$
$$
\omega = \text{(free parameter)}
$$
$$
\omega_{p_s} \equiv \frac{Z_s ^2 n_s}{A_s} = 1
$$
$$
\omega_{c_s} \equiv \frac{Z_s}{A_s} B^0 = -1
$$</p><span>\[\partial F^0 _s / \partial v_\perp = \frac{1}{\pi \alpha_\perp ^2 j!} \frac{2 v_\perp}{\alpha_\perp ^2} e^{- v_\perp ^2 / \alpha_\perp ^2} \left( \frac{v_\perp ^2}{\alpha_\perp ^2}\right)^{j-1} \left[j - \frac{v_\perp ^2}{\alpha_\perp ^2} \right]\]</span>
<script>function loadKatex(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1,trust:e=>["\\htmlId","\\href"].includes(e.command),macros:{"\\lcm":"\\mathop{\\mathrm{lcm}}","\\sen":"\\text{sen}\\,","\\dd":"\\mathop{\\mathrm{d} #1}","\\abs":`\\lvert #1 \\rvert`,"\\dd":"\\text{d}","\\cross":"\\times","\\pdv":"\\frac{\\partial #1}{\\partial #2}","\\curl":`\\nabla \\cross #1`,"\\vu":"\\mathbf{\\hat{#1}}","\\vdot":"\\dot","\\div":`\\nabla \\cdot #1`,"\\grad":`\\nabla`,"\\dv":"\\frac{d\\,#1}{d\\,#2}","\\gr":"\\gamma","\\vec":"\\mathbf{#1}","\\tagl":"\\tag{#1}","\\eqref":"(#1)","\\laplacian":`\\mathbf{\\nabla ^2}`,"\\label":"{}","\\negadelta":`\\nabla`,"\\eqref":"\\href{###1}{(\\text{#1})}","\\ref":"\\href{###1}{\\text{#1}}","\\label":"\\htmlId{#1}{}"}})}</script><p>$$
n = 1
$$</p><p>$$
\omega_p / \omega_c = \left(\frac{n_0 m_0}{\epsilon_0 B_0 ^2} \right)^{1/2} = \text{(free parameter)}
$$</p><p>($\omega_p / \omega_c$ dictates the relative strength of $B$ to $E$)</p><p>We express $k_\perp$ in terms of a normalized wavenumber $\tilde{k}$:</p><p>$$
\tilde{k} \equiv k_\perp v_{\perp, 0} \frac{\omega_p}{\omega_c} \quad \text{(free parameter)}
$$</p><p>$$
\rightarrow \beta_s = - \frac{\tilde{k} v_{\perp}}{v_{\perp, 0}}
$$</p><p>Now let&rsquo;s try to factor out some of the mess from $\chi$. Substituting in our single-species values for $(\omega_{p, s})$, $(\omega_{c, s})$, $(\omega_p \tau)$, and $(\omega_c \tau)$:</p><span>\[\begin{aligned}
\chi & = & -\frac{2 \pi (\omega_p \tau)^2}{\omega (\omega_c \tau)} \frac{\omega_{p, s}^2}{\omega_{c, s}} \int_0 ^\infty \frac{\partial F_s ^0 }{\partial v_\perp} v_\perp ^2 \begin{bmatrix} \frac{\alpha_s}{\beta_s ^2} (1 - Q_s) & - \frac{i}{2 \beta_s} Q_s ^\prime \\ \frac{i}{2 \beta_s} Q_s ^\prime & - \left( \frac{\pi}{\sin (\pi \alpha_s)} J_{- \alpha_s} ^\prime (\beta_s) J_{\alpha_s} ^\prime (\beta_s) + \frac{\alpha_s}{\beta_s ^2} \right) \end{bmatrix} \, d v_\perp \\
& = & -\frac{2 \pi (\omega_p \tau)^2}{\omega (\omega_c \tau)} \frac{\omega_{p, s}^2}{\omega_{c, s}} \int_0 ^\infty \frac{\partial F_s ^0 }{\partial v_\perp} \frac{v_\perp ^2}{\beta_s ^2} \beta_s ^2 \begin{bmatrix} \frac{\alpha_s}{\beta_s ^2} (1 - Q_s) & - \frac{i}{2 \beta_s} Q_s ^\prime \\ \frac{i}{2 \beta_s} Q_s ^\prime & - \left( \frac{\pi}{\sin (\pi \alpha_s)} J_{- \alpha_s} ^\prime (\beta_s) J_{\alpha_s} ^\prime (\beta_s) + \frac{\alpha_s}{\beta_s ^2} \right) \end{bmatrix} \, d v_\perp \\
& = & -\frac{2 \pi (\omega_p \tau)^2}{\omega (\omega_c \tau)} \frac{\omega_{p, s}^2}{\omega_{c, s}} \frac{(\omega_c \tau)^2 \omega_{c, s}^2}{k_\perp ^2} \int_0 ^\infty \frac{\partial F_s ^0 }{\partial v_\perp} \beta_s ^2 \begin{bmatrix} \frac{\alpha_s}{\beta_s ^2} (1 - Q_s) & - \frac{i}{2 \beta_s} Q_s ^\prime \\ \frac{i}{2 \beta_s} Q_s ^\prime & - \left( \frac{\pi}{\sin (\pi \alpha_s)} J_{- \alpha_s} ^\prime (\beta_s) J_{\alpha_s} ^\prime (\beta_s) + \frac{\alpha_s}{\beta_s ^2} \right) \end{bmatrix} \, d v_\perp \\
& = & -\frac{2 \pi v_{\perp, 0}^2 (\omega_p / \omega_c)}{\tilde{k}^2 \omega} \int_0 ^\infty \frac{\partial F_s ^0 }{\partial v_\perp} \beta_s ^2 \begin{bmatrix} \frac{\alpha_s}{\beta_s ^2} (1 - Q_s) & - \frac{i}{2 \beta_s} Q_s ^\prime \\ \frac{i}{2 \beta_s} Q_s ^\prime & - \left( \frac{\pi}{\sin (\pi \alpha_s)} J_{- \alpha_s} ^\prime (\beta_s) J_{\alpha_s} ^\prime (\beta_s) + \frac{\alpha_s}{\beta_s ^2} \right) \end{bmatrix} \, d v_\perp \\
& = & -\frac{2 \pi v_{\perp, 0}^2 (\omega_p / \omega_c)}{\tilde{k}^2 \omega} \int_0 ^\infty \frac{\partial F_s ^0 }{\partial v_\perp} \begin{bmatrix} \alpha_s (1 - Q_s) & - \frac{i \beta_s}{2} Q_s ^\prime \\ \frac{i \beta_s}{2} Q_s ^\prime & - \left( \frac{\pi \beta_s ^2}{\sin (\pi \alpha_s)} J_{- \alpha_s} ^\prime (\beta_s) J_{\alpha_s} ^\prime (\beta_s) + \alpha_s \right) \end{bmatrix} \, d v_\perp \\
\end{aligned}\]</span>
<script>function loadKatex(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1,trust:e=>["\\htmlId","\\href"].includes(e.command),macros:{"\\lcm":"\\mathop{\\mathrm{lcm}}","\\sen":"\\text{sen}\\,","\\dd":"\\mathop{\\mathrm{d} #1}","\\abs":`\\lvert #1 \\rvert`,"\\dd":"\\text{d}","\\cross":"\\times","\\pdv":"\\frac{\\partial #1}{\\partial #2}","\\curl":`\\nabla \\cross #1`,"\\vu":"\\mathbf{\\hat{#1}}","\\vdot":"\\dot","\\div":`\\nabla \\cdot #1`,"\\grad":`\\nabla`,"\\dv":"\\frac{d\\,#1}{d\\,#2}","\\gr":"\\gamma","\\vec":"\\mathbf{#1}","\\tagl":"\\tag{#1}","\\eqref":"(#1)","\\laplacian":`\\mathbf{\\nabla ^2}`,"\\label":"{}","\\negadelta":`\\nabla`,"\\eqref":"\\href{###1}{(\\text{#1})}","\\ref":"\\href{###1}{\\text{#1}}","\\label":"\\htmlId{#1}{}"}})}</script><p>Let&rsquo;s re-write things a bit for simplicity:</p><span>\[R_{ij} = \begin{bmatrix}
\alpha _s (1 - Q _s) & - \frac{i \beta _s}{2} Q ^\prime _s \\\\
\frac{i \beta _s}{2} Q^\prime _s & - \beta _s ^2 \left( \frac{\pi}{\sin (\pi \alpha _s)} J_{- \alpha _s} ^\prime (\beta _s) J_{\alpha _s} ^\prime (\beta _s) + \frac{\alpha _s}{\beta _s ^2} \right)
\end{bmatrix}\]</span>
<script>function loadKatex(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1,trust:e=>["\\htmlId","\\href"].includes(e.command),macros:{"\\lcm":"\\mathop{\\mathrm{lcm}}","\\sen":"\\text{sen}\\,","\\dd":"\\mathop{\\mathrm{d} #1}","\\abs":`\\lvert #1 \\rvert`,"\\dd":"\\text{d}","\\cross":"\\times","\\pdv":"\\frac{\\partial #1}{\\partial #2}","\\curl":`\\nabla \\cross #1`,"\\vu":"\\mathbf{\\hat{#1}}","\\vdot":"\\dot","\\div":`\\nabla \\cdot #1`,"\\grad":`\\nabla`,"\\dv":"\\frac{d\\,#1}{d\\,#2}","\\gr":"\\gamma","\\vec":"\\mathbf{#1}","\\tagl":"\\tag{#1}","\\eqref":"(#1)","\\laplacian":`\\mathbf{\\nabla ^2}`,"\\label":"{}","\\negadelta":`\\nabla`,"\\eqref":"\\href{###1}{(\\text{#1})}","\\ref":"\\href{###1}{\\text{#1}}","\\label":"\\htmlId{#1}{}"}})}</script><p>Using Bessel function identities,</p><p>$$
R_{22} = - \beta_s ^2 \left( \frac{\pi}{\sin (\pi \alpha_s)} J_{- \alpha_s} ^\prime (\beta_s) J_{\alpha_s} ^\prime (\beta_s) + \frac{\alpha_s}{\beta_s ^2} \right) \\
= - \beta_s ^2 \left(\frac{\pi}{\sin (\pi \alpha_s)} \left[ \frac{1}{\pi} \left( \int _0 ^{\pi / 2} \cos (2 \alpha_s \theta) \left[ J_2(2 \beta_s \cos \theta) - J_0 (2 \beta_s \cos \theta) \cos (2 \theta) \right] d \theta - \frac{\alpha_s}{\beta_s ^2} \sin (\pi \alpha_s) \right) \right] + \frac{\alpha_s}{\beta_s} \right) \\
= - \frac{\beta_s ^2}{\sin (\pi \alpha_s)} \int_0 ^{\pi / 2} \cos (2 \alpha_s \theta) \left[ J_2(2 \beta_s \cos \theta) - J_0 (2 \beta_s \cos \theta) \cos (2 \theta) \right] \, d \theta
$$</p><p>Still not pretty, but we can give it a try. Let&rsquo;s try using
<a href=https://github.com/JuliaMath/QuadGK.jl>https://github.com/JuliaMath/QuadGK.jl</a> to compute the improper integral over $v_\perp$, and use Gauss-Legendre quadrature to compute the interior $\theta$ integrals.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-julia data-lang=julia><span style=display:flex><span><span style=color:#66d9ef>using</span> Pkg
</span></span><span style=display:flex><span>Pkg<span style=color:#f92672>.</span>add(<span style=color:#e6db74>&#34;Plots&#34;</span>)
</span></span><span style=display:flex><span>Pkg<span style=color:#f92672>.</span>add(<span style=color:#e6db74>&#34;PythonPlot&#34;</span>)
</span></span><span style=display:flex><span>Pkg<span style=color:#f92672>.</span>add(<span style=color:#e6db74>&#34;HDF5&#34;</span>)
</span></span><span style=display:flex><span>Pkg<span style=color:#f92672>.</span>add(<span style=color:#e6db74>&#34;Optim&#34;</span>)
</span></span><span style=display:flex><span>Pkg<span style=color:#f92672>.</span>add(<span style=color:#e6db74>&#34;LaTeXStrings&#34;</span>)
</span></span><span style=display:flex><span>Pkg<span style=color:#f92672>.</span>add(url<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://github.com/JuliaApproximation/FastGaussQuadrature.jl&#34;</span>)
</span></span><span style=display:flex><span>Pkg<span style=color:#f92672>.</span>add(url<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://github.com/JuliaMath/Bessels.jl.git&#34;</span>)
</span></span><span style=display:flex><span>Pkg<span style=color:#f92672>.</span>add(url<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://github.com/JuliaMath/QuadGK.jl&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Bessels  <span style=color:#75715e># besselj</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> FastGaussQuadrature  <span style=color:#75715e># compute gauss-legendre points</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> HDF5  <span style=color:#75715e># store/read from file</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> LaTeXStrings  <span style=color:#75715e># Plot formatting</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> LinearAlgebra  <span style=color:#75715e># dot.()</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Optim  <span style=color:#75715e># Newton-Raphson descent to find zeros</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Plots  <span style=color:#75715e># Matplotlib metapackage</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> QuadGK  <span style=color:#75715e># Alternative integrator</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set plotting backend to matplotlib</span>
</span></span><span style=display:flex><span>pythonplot()
</span></span><span style=display:flex><span><span style=color:#75715e># Set plotting backend to GR</span>
</span></span><span style=display:flex><span><span style=color:#75715e># gr()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Base.@kwdef is a macro that allows for keyword arguments and default values</span>
</span></span><span style=display:flex><span>Base<span style=color:#f92672>.</span><span style=color:#a6e22e>@kwdef</span> <span style=color:#66d9ef>struct</span> <span style=color:#66d9ef>DispersionCase</span>
</span></span><span style=display:flex><span>  id<span style=color:#f92672>::</span><span style=color:#66d9ef>String</span>
</span></span><span style=display:flex><span>  knorm<span style=color:#f92672>::</span><span style=color:#66d9ef>Float64</span>
</span></span><span style=display:flex><span>  j<span style=color:#f92672>::</span><span style=color:#66d9ef>Int</span>
</span></span><span style=display:flex><span>  width<span style=color:#f92672>::</span><span style=color:#66d9ef>Float64</span>
</span></span><span style=display:flex><span>  wpwc<span style=color:#f92672>::</span><span style=color:#66d9ef>Float64</span>
</span></span><span style=display:flex><span>  guesses<span style=color:#f92672>::</span><span style=color:#66d9ef>Vector</span>{<span style=color:#66d9ef>Vector</span>{<span style=color:#66d9ef>Float64</span>}}
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> case_a <span style=color:#f92672>=</span> DispersionCase(id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;A&#34;</span>, knorm<span style=color:#f92672>=</span><span style=color:#ae81ff>3.15</span>, j<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>, width<span style=color:#f92672>=</span>sqrt(<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>3</span>), wpwc<span style=color:#f92672>=</span><span style=color:#ae81ff>20.0</span>, guesses<span style=color:#f92672>=</span>[[<span style=color:#ae81ff>0.0</span>,<span style=color:#ae81ff>0.5</span>]])
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> case_b <span style=color:#f92672>=</span> DispersionCase(id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;B&#34;</span>, knorm<span style=color:#f92672>=</span><span style=color:#ae81ff>4.64</span>, j<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>, width<span style=color:#f92672>=</span>sqrt(<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>3</span>), wpwc<span style=color:#f92672>=</span><span style=color:#ae81ff>20.0</span>, guesses<span style=color:#f92672>=</span>[[<span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>0.3</span>]])
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> case_c <span style=color:#f92672>=</span> DispersionCase(id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;C&#34;</span>, knorm<span style=color:#f92672>=</span><span style=color:#ae81ff>2.12</span>, j<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>, width<span style=color:#f92672>=</span><span style=color:#ae81ff>1.0</span>, wpwc<span style=color:#f92672>=</span><span style=color:#ae81ff>10.0</span>, guesses<span style=color:#f92672>=</span>[[<span style=color:#ae81ff>0.8</span>, <span style=color:#ae81ff>0.12</span>]])
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> case_d <span style=color:#f92672>=</span> DispersionCase(id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;D&#34;</span>, knorm<span style=color:#f92672>=</span><span style=color:#ae81ff>2.12</span>, j<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, width<span style=color:#f92672>=</span>sqrt(<span style=color:#ae81ff>2</span>), wpwc<span style=color:#f92672>=</span><span style=color:#ae81ff>1.0</span>, guesses<span style=color:#f92672>=</span>[[<span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>0.0</span>]])
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> cases <span style=color:#f92672>=</span> [case_a, case_b, case_c, case_d]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> solve_em_dispersion(;knorm, j, width, wpwc, wr, wi)
</span></span><span style=display:flex><span>  v_0 <span style=color:#f92672>=</span> sqrt(j) <span style=color:#f92672>*</span> width
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> dF0_dv(v)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> v <span style=color:#f92672>/</span> (pi <span style=color:#f92672>*</span> width<span style=color:#f92672>^</span><span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> factorial(j)) <span style=color:#f92672>*</span> exp(<span style=color:#f92672>-</span>v<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> width<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>) <span style=color:#f92672>*</span> (v<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> width<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>)<span style=color:#f92672>^</span>(j <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (j <span style=color:#f92672>-</span> (v<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> width<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  quad_samples, quad_weights <span style=color:#f92672>=</span> gausslegendre(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># Transform from [-1, 1] to [0, 20]</span>
</span></span><span style=display:flex><span>  v_samples <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> <span style=color:#ae81ff>10.0</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1.0</span> <span style=color:#f92672>+</span> quad_samples)
</span></span><span style=display:flex><span>  v_weights <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> <span style=color:#ae81ff>10.0</span> <span style=color:#f92672>*</span> quad_weights
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># Transform from [-1, 1] to [0, pi/2] for interior quadrature calculations</span>
</span></span><span style=display:flex><span>  theta <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.25</span> <span style=color:#f92672>*</span> pi <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1.0</span> <span style=color:#f92672>.+</span> quad_samples)
</span></span><span style=display:flex><span>  theta_weights <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.25</span> <span style=color:#f92672>*</span> pi <span style=color:#f92672>.*</span> quad_weights
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> Q_s(alpha, beta)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> alpha <span style=color:#f92672>/</span> sin(pi <span style=color:#f92672>*</span> alpha)) <span style=color:#f92672>*</span> dot(theta_weights, besselj0<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> beta <span style=color:#f92672>*</span> cos<span style=color:#f92672>.</span>(theta)) <span style=color:#f92672>.*</span> cos<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> alpha <span style=color:#f92672>.*</span> theta))
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> Qp_s(alpha, beta)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>(<span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> alpha <span style=color:#f92672>/</span> sin(pi <span style=color:#f92672>*</span> alpha)) <span style=color:#f92672>*</span> dot(theta_weights, besselj1<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> beta <span style=color:#f92672>*</span> cos<span style=color:#f92672>.</span>(theta)) <span style=color:#f92672>.*</span> cos<span style=color:#f92672>.</span>(theta) <span style=color:#f92672>.*</span> cos<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> alpha <span style=color:#f92672>.*</span> theta))
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> R22(alpha, beta)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (<span style=color:#f92672>-</span>beta<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> sin(pi <span style=color:#f92672>*</span> alpha)) <span style=color:#f92672>*</span> dot(theta_weights, cos<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> alpha <span style=color:#f92672>*</span> theta) <span style=color:#f92672>.*</span> (besselj<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> beta <span style=color:#f92672>*</span> cos<span style=color:#f92672>.</span>(theta)) <span style=color:#f92672>-</span> besselj0<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> beta <span style=color:#f92672>*</span> cos<span style=color:#f92672>.</span>(theta)) <span style=color:#f92672>.*</span> cos<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> theta)))
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># quadgk integration tolerance</span>
</span></span><span style=display:flex><span>  rtol <span style=color:#f92672>=</span> <span style=color:#ae81ff>1e-10</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> r11(w)
</span></span><span style=display:flex><span>    alpha <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>w <span style=color:#f92672>*</span> wpwc
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> integrand(v)
</span></span><span style=display:flex><span>      beta <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>knorm <span style=color:#f92672>*</span> v <span style=color:#f92672>/</span> v_0
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> dF0_dv(v) <span style=color:#f92672>*</span> alpha <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> Q_s(alpha, beta))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    I, err <span style=color:#f92672>=</span> quadgk(integrand, <span style=color:#ae81ff>0.0</span>, Inf, rtol<span style=color:#f92672>=</span>rtol)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> I
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> r12(w)
</span></span><span style=display:flex><span>    alpha <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>w <span style=color:#f92672>*</span> wpwc
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> integrand(v)
</span></span><span style=display:flex><span>      beta <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>knorm <span style=color:#f92672>*</span> v <span style=color:#f92672>/</span> v_0
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>dF0_dv(v) <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>*</span> im <span style=color:#f92672>*</span> beta <span style=color:#f92672>*</span> Qp_s(alpha, beta)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    I, err <span style=color:#f92672>=</span> quadgk(integrand, <span style=color:#ae81ff>0.0</span>, Inf, rtol<span style=color:#f92672>=</span>rtol)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> I
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> r22(w)
</span></span><span style=display:flex><span>    alpha <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>w <span style=color:#f92672>*</span> wpwc
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> integrand(v)
</span></span><span style=display:flex><span>      beta <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>knorm <span style=color:#f92672>*</span> v <span style=color:#f92672>/</span> v_0
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>dF0_dv(v) <span style=color:#f92672>*</span> (<span style=color:#f92672>-</span>beta<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> sin(pi <span style=color:#f92672>*</span> alpha)) <span style=color:#f92672>*</span> dot(theta_weights, cos<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> alpha <span style=color:#f92672>*</span> theta) <span style=color:#f92672>.*</span> (besselj<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> beta <span style=color:#f92672>*</span> cos<span style=color:#f92672>.</span>(theta)) <span style=color:#f92672>-</span> besselj0<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> beta <span style=color:#f92672>*</span> cos<span style=color:#f92672>.</span>(theta)) <span style=color:#f92672>.*</span> cos<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> theta)))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    I, err <span style=color:#f92672>=</span> quadgk(integrand, <span style=color:#ae81ff>0.0</span>, Inf, rtol<span style=color:#f92672>=</span>rtol)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> I
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> dispersion(w)
</span></span><span style=display:flex><span>    coeff <span style=color:#f92672>=</span> <span style=color:#ae81ff>2.0</span> <span style=color:#f92672>*</span> pi <span style=color:#f92672>*</span> v_0<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> wpwc <span style=color:#f92672>/</span> (knorm<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> w)
</span></span><span style=display:flex><span>    x11 <span style=color:#f92672>=</span> coeff <span style=color:#f92672>*</span> r11(w)
</span></span><span style=display:flex><span>    x12 <span style=color:#f92672>=</span> coeff <span style=color:#f92672>*</span> r12(w)
</span></span><span style=display:flex><span>    x22 <span style=color:#f92672>=</span> coeff <span style=color:#f92672>*</span> r22(w)
</span></span><span style=display:flex><span>    k11 <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>+</span> x11
</span></span><span style=display:flex><span>    k12 <span style=color:#f92672>=</span> x12
</span></span><span style=display:flex><span>    k21 <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>x12
</span></span><span style=display:flex><span>    k22 <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>+</span> x22
</span></span><span style=display:flex><span>    D <span style=color:#f92672>=</span> k11 <span style=color:#f92672>*</span> (k22 <span style=color:#f92672>+</span> knorm<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> (v_0 <span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> w<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>)) <span style=color:#f92672>-</span> k12 <span style=color:#f92672>*</span> k21
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> D
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  w <span style=color:#f92672>=</span> wr <span style=color:#f92672>+</span> im <span style=color:#f92672>*</span> wi
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> dispersion(w)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> solve_es_dispersion(;knorm, j, width, wpwc, wr, wi)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> plot_contours_from_file(filename)
</span></span><span style=display:flex><span>  fid <span style=color:#f92672>=</span> HDF5<span style=color:#f92672>.</span>h5open(filename, <span style=color:#e6db74>&#34;r&#34;</span>)
</span></span><span style=display:flex><span>  x <span style=color:#f92672>=</span> HDF5<span style=color:#f92672>.</span>read(fid[<span style=color:#e6db74>&#34;w_r&#34;</span>])
</span></span><span style=display:flex><span>  y <span style=color:#f92672>=</span> HDF5<span style=color:#f92672>.</span>read(fid[<span style=color:#e6db74>&#34;w_i&#34;</span>])
</span></span><span style=display:flex><span>  D <span style=color:#f92672>=</span> HDF5<span style=color:#f92672>.</span>read(fid[<span style=color:#e6db74>&#34;D&#34;</span>])
</span></span><span style=display:flex><span>  case_id <span style=color:#f92672>=</span> HDF5<span style=color:#f92672>.</span>read(fid[<span style=color:#e6db74>&#34;caseId&#34;</span>])
</span></span><span style=display:flex><span>  wpwc <span style=color:#f92672>=</span> HDF5<span style=color:#f92672>.</span>read(fid[<span style=color:#e6db74>&#34;wpwc&#34;</span>])
</span></span><span style=display:flex><span>  close(fid)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  z <span style=color:#f92672>=</span> abs<span style=color:#f92672>.</span>(D)
</span></span><span style=display:flex><span>  min_log <span style=color:#f92672>=</span> minimum(z) <span style=color:#f92672>/</span> maximum(z)
</span></span><span style=display:flex><span>  min_level <span style=color:#f92672>=</span> trunc(<span style=color:#66d9ef>Int</span>, log(min_log))
</span></span><span style=display:flex><span>  levels <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>min_level<span style=color:#f92672>:</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  colorbar_labels <span style=color:#f92672>=</span> [<span style=color:#e6db74>L</span><span style=color:#e6db74>&#34;10^{%</span><span style=color:#e6db74>$i</span><span style=color:#e6db74>}&#34;</span> <span style=color:#66d9ef>for</span> i <span style=color:#66d9ef>in</span> levels]
</span></span><span style=display:flex><span>  plt <span style=color:#f92672>=</span> contourf(x, y, log10<span style=color:#f92672>.</span>(z <span style=color:#f92672>./</span> maximum(z)), levels<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>:cool</span>, colorbar_ticks<span style=color:#f92672>=</span>(levels, colorbar_labels))
</span></span><span style=display:flex><span>  title!(<span style=color:#e6db74>L</span><span style=color:#e6db74>&#34;$|D|/|D|_{max}$ (Case &#34;</span> <span style=color:#f92672>*</span> case_id <span style=color:#f92672>*</span> <span style=color:#e6db74>&#34;)&#34;</span>)
</span></span><span style=display:flex><span>  xlabel!(<span style=color:#e6db74>L</span><span style=color:#e6db74>&#34;Re(</span><span style=color:#ae81ff>\t</span><span style=color:#e6db74>ilde{\omega})&#34;</span>)
</span></span><span style=display:flex><span>  ylabel!(<span style=color:#e6db74>L</span><span style=color:#e6db74>&#34;Im(</span><span style=color:#ae81ff>\t</span><span style=color:#e6db74>ilde{\omega})&#34;</span>)
</span></span><span style=display:flex><span>  savefig(plt, <span style=color:#e6db74>&#34;julia-dgh-case&#34;</span> <span style=color:#f92672>*</span> case_id <span style=color:#f92672>*</span> <span style=color:#e6db74>&#34;.pdf&#34;</span>)
</span></span><span style=display:flex><span>  display(plt)
</span></span><span style=display:flex><span>  contour_plt <span style=color:#f92672>=</span> contour(x, y, real<span style=color:#f92672>.</span>(D), levels<span style=color:#f92672>=</span>[<span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.001</span>], c<span style=color:#f92672>=</span>[<span style=color:#e6db74>:black</span>], ls<span style=color:#f92672>=</span>[<span style=color:#e6db74>:solid</span>])
</span></span><span style=display:flex><span>  contour!(contour_plt, x, y, imag<span style=color:#f92672>.</span>(D), levels<span style=color:#f92672>=</span>[<span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.001</span>], c<span style=color:#f92672>=</span>[<span style=color:#e6db74>:black</span>], ls<span style=color:#f92672>=</span>[<span style=color:#e6db74>:dash</span>])
</span></span><span style=display:flex><span>  title!(<span style=color:#e6db74>L</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$Re</span><span style=color:#e6db74>(D)=0$ and </span><span style=color:#e6db74>$Im</span><span style=color:#e6db74>(D)=0$ (Case &#34;</span> <span style=color:#f92672>*</span> case_id <span style=color:#f92672>*</span> <span style=color:#e6db74>&#34;)&#34;</span>)
</span></span><span style=display:flex><span>  display(contour_plt)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> run_case(case, file_base_name, num_pts)
</span></span><span style=display:flex><span>  filename <span style=color:#f92672>=</span> file_base_name <span style=color:#f92672>*</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#f92672>*</span> case<span style=color:#f92672>.</span>id <span style=color:#f92672>*</span> <span style=color:#e6db74>&#34;.h5&#34;</span>
</span></span><span style=display:flex><span>  fid <span style=color:#f92672>=</span> HDF5<span style=color:#f92672>.</span>h5open(filename, <span style=color:#e6db74>&#34;w&#34;</span>)
</span></span><span style=display:flex><span>  fid[<span style=color:#e6db74>&#34;caseId&#34;</span>] <span style=color:#f92672>=</span> case<span style=color:#f92672>.</span>id
</span></span><span style=display:flex><span>  fid[<span style=color:#e6db74>&#34;knorm&#34;</span>] <span style=color:#f92672>=</span> case<span style=color:#f92672>.</span>knorm
</span></span><span style=display:flex><span>  fid[<span style=color:#e6db74>&#34;j&#34;</span>] <span style=color:#f92672>=</span> case<span style=color:#f92672>.</span>j
</span></span><span style=display:flex><span>  fid[<span style=color:#e6db74>&#34;width&#34;</span>] <span style=color:#f92672>=</span> case<span style=color:#f92672>.</span>width
</span></span><span style=display:flex><span>  fid[<span style=color:#e6db74>&#34;wpwc&#34;</span>] <span style=color:#f92672>=</span> case<span style=color:#f92672>.</span>wpwc
</span></span><span style=display:flex><span>  x <span style=color:#f92672>=</span> range(<span style=color:#f92672>-</span><span style=color:#ae81ff>0.1</span>, <span style=color:#ae81ff>3.0</span>, length<span style=color:#f92672>=</span>num_pts)
</span></span><span style=display:flex><span>  y <span style=color:#f92672>=</span> range(<span style=color:#f92672>-</span><span style=color:#ae81ff>0.1</span>, <span style=color:#ae81ff>1.5</span>, length<span style=color:#f92672>=</span>num_pts)
</span></span><span style=display:flex><span>  fid[<span style=color:#e6db74>&#34;w_r&#34;</span>] <span style=color:#f92672>=</span> collect(x)
</span></span><span style=display:flex><span>  fid[<span style=color:#e6db74>&#34;w_i&#34;</span>] <span style=color:#f92672>=</span> collect(y)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> em_dispersion(wr, wi)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> solve_em_dispersion(knorm<span style=color:#f92672>=</span>case<span style=color:#f92672>.</span>knorm, j<span style=color:#f92672>=</span>case<span style=color:#f92672>.</span>j, width<span style=color:#f92672>=</span>case<span style=color:#f92672>.</span>width, wpwc<span style=color:#f92672>=</span>case<span style=color:#f92672>.</span>wpwc, wr<span style=color:#f92672>=</span>wr, wi<span style=color:#f92672>=</span>wi)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  println(<span style=color:#e6db74>&#34;Running case &#34;</span>, case<span style=color:#f92672>.</span>id, <span style=color:#e6db74>&#34; over &#34;</span>, num_pts<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#34; total points...&#34;</span> )
</span></span><span style=display:flex><span>  D <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> em_dispersion(x<span style=color:#f92672>&#39;</span> <span style=color:#f92672>./</span> case<span style=color:#f92672>.</span>wpwc, y <span style=color:#f92672>./</span> case<span style=color:#f92672>.</span>wpwc)
</span></span><span style=display:flex><span>  fid[<span style=color:#e6db74>&#34;D&#34;</span>] <span style=color:#f92672>=</span> D
</span></span><span style=display:flex><span>  close(fid)
</span></span><span style=display:flex><span>  println(<span style=color:#e6db74>&#34;Finished. Writing to file &#34;</span>, filename)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> filename
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>filename <span style=color:#f92672>=</span> run_case(cases[<span style=color:#ae81ff>1</span>], <span style=color:#e6db74>&#34;data&#34;</span>, <span style=color:#ae81ff>320</span>)
</span></span><span style=display:flex><span>plot_contours_from_file(filename)
</span></span></code></pre></div><p>It&rsquo;s very close! The basic anatomy looks to be nearly correct. Most importantly, the fastest-growing mode (the zero with the largest imaginary frequency component) that we see appears to be near the expected $\tilde{\omega} = 0.0 + 0:4912i$:</p><p align=center><img alt=img/research/dgh/dispersion-fail-julia-1.png src=/r/img/research/dgh/dispersion-fail-julia-1.png></p><p align=center><img alt=img/research/dgh/dispersion-fail-julia-1.png src=/r/img/research/dgh/dispersion-fail-julia-1-contour.png></p><p>We can confirm by running a minimization scheme near the zero to get a precise value. I&rsquo;ll use the Optim.jl library to perform the descent minimization:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-julia data-lang=julia><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> find_zero(case)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> em_dispersion(w)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> abs(solve_em_dispersion(knorm<span style=color:#f92672>=</span>case<span style=color:#f92672>.</span>knorm, j<span style=color:#f92672>=</span>case<span style=color:#f92672>.</span>j, width<span style=color:#f92672>=</span>case<span style=color:#f92672>.</span>width, wpwc<span style=color:#f92672>=</span>case<span style=color:#f92672>.</span>wpwc, wr<span style=color:#f92672>=</span>w[<span style=color:#ae81ff>1</span>], wi<span style=color:#f92672>=</span>w[<span style=color:#ae81ff>2</span>]))
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  println(<span style=color:#e6db74>&#34;========== Case &#34;</span>, case<span style=color:#f92672>.</span>id, <span style=color:#e6db74>&#34; ==========&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> guess <span style=color:#66d9ef>in</span> case<span style=color:#f92672>.</span>guesses
</span></span><span style=display:flex><span>    start <span style=color:#f92672>=</span> [guess[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>/</span> case<span style=color:#f92672>.</span>wpwc, guess[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>/</span> case<span style=color:#f92672>.</span>wpwc]
</span></span><span style=display:flex><span>    println(<span style=color:#e6db74>&#34;Searching for zero near w = &#34;</span>, guess[<span style=color:#ae81ff>1</span>], <span style=color:#e6db74>&#34; + &#34;</span>, guess[<span style=color:#ae81ff>2</span>], <span style=color:#e6db74>&#34;i&#34;</span>)
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> optimize(em_dispersion, start, Optim<span style=color:#f92672>.</span>Options(x_tol <span style=color:#f92672>=</span> <span style=color:#ae81ff>1e-6</span>))
</span></span><span style=display:flex><span>    println(<span style=color:#e6db74>&#34;Case &#34;</span>, case<span style=color:#f92672>.</span>id, <span style=color:#e6db74>&#34;:&#34;</span>)
</span></span><span style=display:flex><span>    display(result)
</span></span><span style=display:flex><span>    println(<span style=color:#e6db74>&#34;Did we find a root? Maybe! We think there is a root at:&#34;</span>)
</span></span><span style=display:flex><span>    println(<span style=color:#e6db74>&#34;w = &#34;</span>, round(Optim<span style=color:#f92672>.</span>minimizer(result)[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>*</span> case<span style=color:#f92672>.</span>wpwc, digits<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>), <span style=color:#e6db74>&#34; + &#34;</span>, round(Optim<span style=color:#f92672>.</span>minimizer(result)[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>*</span> case<span style=color:#f92672>.</span>wpwc, digits<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>), <span style=color:#e6db74>&#34;i&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>find_zero(cases[<span style=color:#ae81ff>1</span>])
</span></span></code></pre></div><pre tabindex=0><code>========== Case A ==========
Searching for zero near w = 0.0 + 0.5i
 * Status: success

 * Candidate solution
    Final objective value:     2.739900e-08

 * Found with
    Algorithm:     Nelder-Mead

 * Convergence measures
    √(Σ(yᵢ-ȳ)²)/n ≤ 1.0e-08

 * Work counters
    Seconds run:   3  (vs limit Inf)
    Iterations:    94
    f(x) calls:    184
Case A:
Did we find a root? Maybe! We think there is a root at:
w = 0.0 + 0.49123i
</code></pre><p>So far so good! But I am very suspicious that I don&rsquo;t see any other growing modes. From Iman&rsquo;s paper I would expect to see another solution near $\tilde{\omega} = 1.9 + 0.2i$ Let&rsquo;s try a different case, setting $\tilde{k} = 4.65$. This is &ldquo;Case B&rdquo; in the paper, and I expect a solution at $\tilde{\omega} = 1.0363 + 0.2900i$:</p><pre tabindex=0><code>========== Case B ==========
Searching for zero near w = 1.0 + 0.3i
 * Status: success

 * Candidate solution
    Final objective value:     2.216717e-08

 * Found with
    Algorithm:     Nelder-Mead

 * Convergence measures
    √(Σ(yᵢ-ȳ)²)/n ≤ 1.0e-08

 * Work counters
    Seconds run:   3  (vs limit Inf)
    Iterations:    89
    f(x) calls:    175
Case B:
Did we find a root? Maybe! We think there is a root at:
w = 1.03461 + 0.28968i
</code></pre><p>Hmm, that is much further off than I would like. Decreasing the tolerance for the QuadGK integrals does not change the result, and increasing the number of Gauss-Legendre quadrature points also makes no difference.</p><p>How about we try doing the v integrals by quadrature as well?</p><p>No quadrature, two contour plots with 400pts each: 16.7 sec
Quadrature, two contour plots with 400pts each: 6.1 sec!</p><p>Back to the original attempt code, evaluating with 1600pts each and threading I get 30.7s with QuadGK, and 6.3s with my own quadrature! Let&rsquo;s definitely use that instead:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-julia data-lang=julia><span style=display:flex><span><span style=color:#66d9ef>function</span> solve_em_dispersion(; knorm, j, width, wpwc, w_array)
</span></span><span style=display:flex><span>  <span style=color:#75715e># All normalization parameters</span>
</span></span><span style=display:flex><span>  Ze <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>  <span style=color:#75715e># Charge ratio for species</span>
</span></span><span style=display:flex><span>  Ae <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span>  <span style=color:#75715e># Mass ratio for species</span>
</span></span><span style=display:flex><span>  wptau <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span>  <span style=color:#75715e># Time normalization</span>
</span></span><span style=display:flex><span>  wctau <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> wpwc  <span style=color:#75715e># omega_c * tau</span>
</span></span><span style=display:flex><span>  Omega <span style=color:#f92672>=</span> Ze <span style=color:#f92672>/</span> Ae <span style=color:#f92672>/</span> wpwc  <span style=color:#75715e># Species-dependent cyclotron frequency</span>
</span></span><span style=display:flex><span>  B0z <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span>  <span style=color:#75715e># Magnetic field magnitude</span>
</span></span><span style=display:flex><span>  vp0 <span style=color:#f92672>=</span> sqrt(<span style=color:#ae81ff>2.0</span>)  <span style=color:#75715e># Ring distribution peak velocity</span>
</span></span><span style=display:flex><span>  k <span style=color:#f92672>=</span> knorm <span style=color:#f92672>/</span> vp0 <span style=color:#f92672>/</span> wpwc  <span style=color:#75715e># Normalized k</span>
</span></span><span style=display:flex><span>  ne <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span>  <span style=color:#75715e># Species density</span>
</span></span><span style=display:flex><span>  wce <span style=color:#f92672>=</span> Ze <span style=color:#f92672>/</span> Ae <span style=color:#f92672>*</span> B0z  <span style=color:#75715e># Normalized cyclotron frequency</span>
</span></span><span style=display:flex><span>  wp2 <span style=color:#f92672>=</span> Ze<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> ne <span style=color:#f92672>/</span> Ae  <span style=color:#75715e># Normalized plasma frequency squared</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  beta <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> k <span style=color:#f92672>*</span> v_perp <span style=color:#f92672>/</span> wce <span style=color:#f92672>/</span> wctau
</span></span><span style=display:flex><span>  f0prime <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> v_perp <span style=color:#f92672>/</span> (pi <span style=color:#f92672>*</span> width<span style=color:#f92672>^</span><span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> factorial(j)) <span style=color:#f92672>*</span> exp(<span style=color:#f92672>-</span>v_perp<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> width<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>) <span style=color:#f92672>*</span> (v_perp<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> width<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>)<span style=color:#f92672>^</span>(j <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (j <span style=color:#f92672>-</span> (v_perp<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> width<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Q <span style=color:#f92672>=</span> similar(beta, <span style=color:#66d9ef>ComplexF64</span>)  <span style=color:#75715e># Initialize empty Q</span>
</span></span><span style=display:flex><span>  Qprime <span style=color:#f92672>=</span> similar(beta, <span style=color:#66d9ef>ComplexF64</span>)  <span style=color:#75715e># Initialize empty Q&#39;</span>
</span></span><span style=display:flex><span>  jprime_ma_jprime_pa <span style=color:#f92672>=</span> similar(beta, <span style=color:#66d9ef>ComplexF64</span>)  <span style=color:#75715e># Initialize empty J&#39;_-a(b)*J&#39;_+a(b)</span>
</span></span><span style=display:flex><span>  D <span style=color:#f92672>=</span> similar(w_array, <span style=color:#66d9ef>ComplexF64</span>)  <span style=color:#75715e># Output array for each input w</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (idx, w) <span style=color:#66d9ef>in</span> enumerate(w_array)
</span></span><span style=display:flex><span>    alpha <span style=color:#f92672>=</span> w <span style=color:#f92672>/</span> wce <span style=color:#f92672>/</span> wctau  
</span></span><span style=display:flex><span>    sine_factor <span style=color:#f92672>=</span> pi <span style=color:#f92672>*</span> alpha <span style=color:#f92672>/</span> sin(pi <span style=color:#f92672>*</span> alpha)
</span></span><span style=display:flex><span>    cos_2_a_theta <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> cos(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> alpha <span style=color:#f92672>*</span> theta)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> ii <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span>length(beta)
</span></span><span style=display:flex><span>      two_beta_cos_theta <span style=color:#f92672>=</span> (<span style=color:#ae81ff>2.0</span> <span style=color:#f92672>*</span> beta[ii]) <span style=color:#f92672>.*</span> cos_theta
</span></span><span style=display:flex><span>      Q[ii] <span style=color:#f92672>=</span> sine_factor <span style=color:#f92672>*</span> <span style=color:#ae81ff>2.0</span> <span style=color:#f92672>/</span> pi <span style=color:#f92672>*</span> sum(theta_weights <span style=color:#f92672>.*</span> (besselj0<span style=color:#f92672>.</span>(two_beta_cos_theta) <span style=color:#f92672>.*</span> cos_2_a_theta))
</span></span><span style=display:flex><span>      Qprime[ii] <span style=color:#f92672>=</span> sine_factor <span style=color:#f92672>*</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>4.0</span> <span style=color:#f92672>/</span> pi <span style=color:#f92672>*</span> sum(theta_weights <span style=color:#f92672>.*</span> (besselj1<span style=color:#f92672>.</span>(two_beta_cos_theta) <span style=color:#f92672>.*</span> cos_theta <span style=color:#f92672>.*</span> cos_2_a_theta))
</span></span><span style=display:flex><span>      jprime_ma_jprime_pa[ii] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> pi <span style=color:#f92672>*</span> (sum(theta_weights <span style=color:#f92672>.*</span> (cos_2_a_theta <span style=color:#f92672>.*</span> (besselj<span style=color:#f92672>.</span>(<span style=color:#ae81ff>2</span>, two_beta_cos_theta) <span style=color:#f92672>.-</span> besselj0<span style=color:#f92672>.</span>(two_beta_cos_theta) <span style=color:#f92672>.*</span> cos_2_theta))) <span style=color:#f92672>-</span> alpha <span style=color:#f92672>.*</span> sin<span style=color:#f92672>.</span>(pi <span style=color:#f92672>.*</span> alpha)<span style=color:#f92672>/</span> beta[ii]<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    v_integrand_11 <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> <span style=color:#f92672>-</span> f0prime <span style=color:#f92672>*</span> (alpha <span style=color:#f92672>/</span> beta<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1.0</span> <span style=color:#f92672>-</span> Q)) <span style=color:#f92672>*</span> v_perp<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    v_integrand_12 <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> f0prime <span style=color:#f92672>*</span> (im <span style=color:#f92672>/</span> <span style=color:#ae81ff>2.0</span> <span style=color:#f92672>/</span> beta <span style=color:#f92672>*</span> Qprime) <span style=color:#f92672>*</span> v_perp<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    v_integrand_22 <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> f0prime <span style=color:#f92672>*</span> (sine_factor <span style=color:#f92672>/</span> alpha <span style=color:#f92672>*</span> jprime_ma_jprime_pa <span style=color:#f92672>+</span> alpha <span style=color:#f92672>/</span> beta<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>) <span style=color:#f92672>*</span> v_perp<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    coeff <span style=color:#f92672>=</span> wptau<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> wctau <span style=color:#f92672>*</span> <span style=color:#ae81ff>2.0</span> <span style=color:#f92672>*</span> pi <span style=color:#f92672>*</span> wp2 <span style=color:#f92672>/</span> w <span style=color:#f92672>/</span> wce
</span></span><span style=display:flex><span>    chi_xx <span style=color:#f92672>=</span> coeff <span style=color:#f92672>*</span> sum(v_weights <span style=color:#f92672>.*</span> v_integrand_11)
</span></span><span style=display:flex><span>    chi_xy <span style=color:#f92672>=</span> coeff <span style=color:#f92672>*</span> sum(v_weights <span style=color:#f92672>.*</span> v_integrand_12)
</span></span><span style=display:flex><span>    chi_yy <span style=color:#f92672>=</span> coeff <span style=color:#f92672>*</span> sum(v_weights <span style=color:#f92672>.*</span> v_integrand_22)
</span></span><span style=display:flex><span>    K_xx <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>+</span> chi_xx
</span></span><span style=display:flex><span>    K_xy <span style=color:#f92672>=</span> chi_xy
</span></span><span style=display:flex><span>    K_yx <span style=color:#f92672>=</span> <span style=color:#f92672>-</span> K_xy
</span></span><span style=display:flex><span>    K_yy <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>+</span> chi_yy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    D[idx] <span style=color:#f92672>=</span> K_xx <span style=color:#f92672>*</span> (K_yy <span style=color:#f92672>-</span> wptau<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> w<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> wctau<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> k<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>) <span style=color:#f92672>-</span> K_xy <span style=color:#f92672>*</span> K_yx
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> D
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>We&rsquo;ve got to use some <code>for</code> loops instead of straight broadcasting to do the double integral properly, but now we get the same results as the paper! Similarly, we should be able to compute the electrostatic version using either the simplified single-species version from Tartaronis or the full multi-species version from Vogman. We&rsquo;ll use the latter:</p><p><span>\[D(\omega, k_\perp) = 1 + \sum_s M_s \frac{\omega_p ^2}{\omega_c ^2} \int_0 ^\pi \frac{\sin(\omega \tau / \Omega_{cs})}{\sin(\omega \pi / \Omega_{cs})} \sin (\tau) F_0 (\tau + \pi) \dd \tau = 0\]</span>
<script>function loadKatex(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1,trust:e=>["\\htmlId","\\href"].includes(e.command),macros:{"\\lcm":"\\mathop{\\mathrm{lcm}}","\\sen":"\\text{sen}\\,","\\dd":"\\mathop{\\mathrm{d} #1}","\\abs":`\\lvert #1 \\rvert`,"\\dd":"\\text{d}","\\cross":"\\times","\\pdv":"\\frac{\\partial #1}{\\partial #2}","\\curl":`\\nabla \\cross #1`,"\\vu":"\\mathbf{\\hat{#1}}","\\vdot":"\\dot","\\div":`\\nabla \\cdot #1`,"\\grad":`\\nabla`,"\\dv":"\\frac{d\\,#1}{d\\,#2}","\\gr":"\\gamma","\\vec":"\\mathbf{#1}","\\tagl":"\\tag{#1}","\\eqref":"(#1)","\\laplacian":`\\mathbf{\\nabla ^2}`,"\\label":"{}","\\negadelta":`\\nabla`,"\\eqref":"\\href{###1}{(\\text{#1})}","\\ref":"\\href{###1}{\\text{#1}}","\\label":"\\htmlId{#1}{}"}})}</script>where
<span>\[F_0 (\tau) = \int_0 ^\infty f_{s, 0} (v_\perp) J_0 \left( 2 \frac{k_\perp v_\perp}{\Omega_{cs}} \sin(\frac{\tau}{2})\right) 2 \pi v_\perp \dd v_\perp\]</span>
<script>function loadKatex(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1,trust:e=>["\\htmlId","\\href"].includes(e.command),macros:{"\\lcm":"\\mathop{\\mathrm{lcm}}","\\sen":"\\text{sen}\\,","\\dd":"\\mathop{\\mathrm{d} #1}","\\abs":`\\lvert #1 \\rvert`,"\\dd":"\\text{d}","\\cross":"\\times","\\pdv":"\\frac{\\partial #1}{\\partial #2}","\\curl":`\\nabla \\cross #1`,"\\vu":"\\mathbf{\\hat{#1}}","\\vdot":"\\dot","\\div":`\\nabla \\cdot #1`,"\\grad":`\\nabla`,"\\dv":"\\frac{d\\,#1}{d\\,#2}","\\gr":"\\gamma","\\vec":"\\mathbf{#1}","\\tagl":"\\tag{#1}","\\eqref":"(#1)","\\laplacian":`\\mathbf{\\nabla ^2}`,"\\label":"{}","\\negadelta":`\\nabla`,"\\eqref":"\\href{###1}{(\\text{#1})}","\\ref":"\\href{###1}{\\text{#1}}","\\label":"\\htmlId{#1}{}"}})}</script><span>\[\Omega_{cs} \equiv \frac{Z_s \omega_c}{M_s \omega_p}\]</span>
<script>function loadKatex(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1,trust:e=>["\\htmlId","\\href"].includes(e.command),macros:{"\\lcm":"\\mathop{\\mathrm{lcm}}","\\sen":"\\text{sen}\\,","\\dd":"\\mathop{\\mathrm{d} #1}","\\abs":`\\lvert #1 \\rvert`,"\\dd":"\\text{d}","\\cross":"\\times","\\pdv":"\\frac{\\partial #1}{\\partial #2}","\\curl":`\\nabla \\cross #1`,"\\vu":"\\mathbf{\\hat{#1}}","\\vdot":"\\dot","\\div":`\\nabla \\cdot #1`,"\\grad":`\\nabla`,"\\dv":"\\frac{d\\,#1}{d\\,#2}","\\gr":"\\gamma","\\vec":"\\mathbf{#1}","\\tagl":"\\tag{#1}","\\eqref":"(#1)","\\laplacian":`\\mathbf{\\nabla ^2}`,"\\label":"{}","\\negadelta":`\\nabla`,"\\eqref":"\\href{###1}{(\\text{#1})}","\\ref":"\\href{###1}{\\text{#1}}","\\label":"\\htmlId{#1}{}"}})}</script></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-julia data-lang=julia><span style=display:flex><span><span style=color:#66d9ef>function</span> solve_es_dispersion(; knorm, j, width, wpwc, w_array)
</span></span><span style=display:flex><span>  <span style=color:#75715e># All normalization parameters</span>
</span></span><span style=display:flex><span>  Ze <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>  <span style=color:#75715e># Charge ratio for species</span>
</span></span><span style=display:flex><span>  Ae <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span>  <span style=color:#75715e># Mass ratio for species</span>
</span></span><span style=display:flex><span>  wptau <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span>  <span style=color:#75715e># Time normalization</span>
</span></span><span style=display:flex><span>  wctau <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> wpwc  <span style=color:#75715e># omega_c * tau</span>
</span></span><span style=display:flex><span>  Omega <span style=color:#f92672>=</span> Ze <span style=color:#f92672>/</span> Ae <span style=color:#f92672>/</span> wpwc  <span style=color:#75715e># Species-dependent cyclotron frequency</span>
</span></span><span style=display:flex><span>  B0z <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span>  <span style=color:#75715e># Magnetic field magnitude</span>
</span></span><span style=display:flex><span>  vp0 <span style=color:#f92672>=</span> sqrt(<span style=color:#ae81ff>2.0</span>)  <span style=color:#75715e># Ring distribution peak velocity</span>
</span></span><span style=display:flex><span>  k <span style=color:#f92672>=</span> knorm <span style=color:#f92672>/</span> vp0 <span style=color:#f92672>/</span> wpwc  <span style=color:#75715e># Normalized k</span>
</span></span><span style=display:flex><span>  ne <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span>  <span style=color:#75715e># Species density</span>
</span></span><span style=display:flex><span>  wce <span style=color:#f92672>=</span> Ze <span style=color:#f92672>/</span> Ae <span style=color:#f92672>*</span> B0z  <span style=color:#75715e># Normalized cyclotron frequency</span>
</span></span><span style=display:flex><span>  wp2 <span style=color:#f92672>=</span> Ze<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> ne <span style=color:#f92672>/</span> Ae  <span style=color:#75715e># Normalized plasma frequency squared</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># Initial distribution</span>
</span></span><span style=display:flex><span>  vp_alpha <span style=color:#f92672>=</span> v_perp <span style=color:#f92672>./</span> width
</span></span><span style=display:flex><span>  f0 <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> ne <span style=color:#f92672>/</span> (pi <span style=color:#f92672>*</span> width<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> factorial(j)) <span style=color:#f92672>*</span> (vp_alpha)<span style=color:#f92672>^</span>(<span style=color:#ae81ff>2</span><span style=color:#f92672>*</span>j) <span style=color:#f92672>*</span> exp(<span style=color:#f92672>-</span> vp_alpha <span style=color:#f92672>^</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  z <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> k <span style=color:#f92672>*</span> v_perp <span style=color:#f92672>/</span> Omega <span style=color:#f92672>/</span> B0z
</span></span><span style=display:flex><span>  D <span style=color:#f92672>=</span> similar(w_array, <span style=color:#66d9ef>ComplexF64</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (idx, w) <span style=color:#66d9ef>in</span> enumerate(w_array)
</span></span><span style=display:flex><span>    w_alpha <span style=color:#f92672>=</span> w <span style=color:#f92672>/</span> Omega <span style=color:#f92672>/</span> B0z
</span></span><span style=display:flex><span>    tau_int <span style=color:#f92672>=</span> similar(z, <span style=color:#66d9ef>ComplexF64</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> ii <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span>length(z)
</span></span><span style=display:flex><span>      <span style=color:#75715e># tau = range(0.0, pi, 100)</span>
</span></span><span style=display:flex><span>      tau_integrand <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> sin(w_alpha <span style=color:#f92672>*</span> tau) <span style=color:#f92672>/</span> sin(w_alpha <span style=color:#f92672>*</span> pi) <span style=color:#f92672>*</span> sin(tau) <span style=color:#f92672>*</span> besselj0(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> z[ii] <span style=color:#f92672>*</span> sin((tau <span style=color:#f92672>+</span> pi)<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>      <span style=color:#75715e># tau_int[ii] = trapz(tau, tau_integrand)</span>
</span></span><span style=display:flex><span>      tau_int[ii] <span style=color:#f92672>=</span> sum(tau_weights <span style=color:#f92672>.*</span> tau_integrand)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    v_integrand <span style=color:#f92672>=</span> <span style=color:#a6e22e>@.</span> f0 <span style=color:#f92672>*</span> tau_int <span style=color:#f92672>*</span> v_perp
</span></span><span style=display:flex><span>    D[idx] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2.0</span> <span style=color:#f92672>*</span> pi <span style=color:#f92672>*</span> Ze<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>/</span> Ae <span style=color:#f92672>/</span> Omega<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> sum(v_weights <span style=color:#f92672>.*</span> v_integrand)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> D
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><table><thead><tr><th>Electromagnetic</th><th>Electrostatic</th></tr></thead><tbody><tr><td><p align=center><img alt=img/research/dgh/julia-dgh-caseA-contour-em.png src=/r/img/research/dgh/julia-dgh-caseA-contour-em.png style=width:100%></p></td><td><p align=center><img alt=img/research/dgh/julia-dgh-caseA-contour-es.png src=/r/img/research/dgh/julia-dgh-caseA-contour-es.png style=width:100%></p></td></tr><tr><td><p align=center><img alt=img/research/dgh/julia-dgh-caseB-contour-em.png src=/r/img/research/dgh/julia-dgh-caseB-contour-em.png style=width:100%></p></td><td><p align=center><img alt=img/research/dgh/julia-dgh-caseB-contour-es.png src=/r/img/research/dgh/julia-dgh-caseB-contour-es.png style=width:100%></p></td></tr><tr><td><p align=center><img alt=img/research/dgh/julia-dgh-caseC-contour-em.png src=/r/img/research/dgh/julia-dgh-caseC-contour-em.png style=width:100%></p></td><td><p align=center><img alt=img/research/dgh/julia-dgh-caseC-contour-es.png src=/r/img/research/dgh/julia-dgh-caseC-contour-es.png style=width:100%></p></td></tr><tr><td><p align=center><img alt=img/research/dgh/julia-dgh-caseD-contour-em.png src=/r/img/research/dgh/julia-dgh-caseD-contour-em.png style=width:100%></p></td><td><p align=center><img alt=img/research/dgh/julia-dgh-caseD-contour-es.png src=/r/img/research/dgh/julia-dgh-caseD-contour-es.png style=width:100%></p></td></tr></tbody></table></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/Peppyhare/r/commit/83293632a9263613140eae8779fd54eba433aebd title='Last modified by Evan Bluhm | May 26, 2023' target=_blank rel=noopener><img src=/r/svg/calendar.svg class=book-icon alt=Calendar>
<span>May 26, 2023</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main></body></html>