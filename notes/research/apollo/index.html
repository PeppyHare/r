<!doctype html><html lang=en dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Uri mentioned a project by David Beckingsale at LLNL called “Apollo” that attempts to tune kernel parameters at runtime in order to optimize for the available hardware. It’s especially for codes with adaptive capabalities (like adaptive mesh refinement) in which the runtime characteristics of the compute kernels tend to be very input dependent.
This is the main paper they put out: https://computing.llnl.gov/sites/default/files/Apollo-Fast-Lightweight-Dynamic-Tuning-Data-Dependent-Code-LLNL-paper_0.pdf
And here’s the github repository: https://github.com/LLNL/apollo
The approach they take is: At runtime, for each kernel execution apollo collects the runtime and a “feature vector” describing various features of the kernel. These features include:
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://peppyhare.github.io/r/notes/research/apollo/"><meta property="og:site_name" content="My Notes"><meta property="og:title" content="Apollo dynamic tuning framework for RAJA"><meta property="og:description" content="Uri mentioned a project by David Beckingsale at LLNL called “Apollo” that attempts to tune kernel parameters at runtime in order to optimize for the available hardware. It’s especially for codes with adaptive capabalities (like adaptive mesh refinement) in which the runtime characteristics of the compute kernels tend to be very input dependent.
This is the main paper they put out: https://computing.llnl.gov/sites/default/files/Apollo-Fast-Lightweight-Dynamic-Tuning-Data-Dependent-Code-LLNL-paper_0.pdf
And here’s the github repository: https://github.com/LLNL/apollo
The approach they take is: At runtime, for each kernel execution apollo collects the runtime and a “feature vector” describing various features of the kernel. These features include:"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="notes"><meta property="article:modified_time" content="2025-10-23T17:20:40-07:00"><meta itemprop=name content="Apollo dynamic tuning framework for RAJA"><meta itemprop=description content="Uri mentioned a project by David Beckingsale at LLNL called “Apollo” that attempts to tune kernel parameters at runtime in order to optimize for the available hardware. It’s especially for codes with adaptive capabalities (like adaptive mesh refinement) in which the runtime characteristics of the compute kernels tend to be very input dependent.
This is the main paper they put out: https://computing.llnl.gov/sites/default/files/Apollo-Fast-Lightweight-Dynamic-Tuning-Data-Dependent-Code-LLNL-paper_0.pdf
And here’s the github repository: https://github.com/LLNL/apollo
The approach they take is: At runtime, for each kernel execution apollo collects the runtime and a “feature vector” describing various features of the kernel. These features include:"><meta itemprop=dateModified content="2025-10-23T17:20:40-07:00"><meta itemprop=wordCount content="5742"><title>Apollo dynamic tuning framework for RAJA | My Notes</title><link rel=icon href=/r/favicon.png><link rel=manifest href=/r/manifest.json><link rel=canonical href=https://peppyhare.github.io/r/notes/research/apollo/><link rel=stylesheet href=/r/book.min.bff56aeef7242395ec77303d273e044b6e6131a5e670ccb81dfa0f44a300fae2.css integrity="sha256-v/Vq7vckI5XsdzA9Jz4ES25hMaXmcMy4HfoPRKMA+uI=" crossorigin=anonymous><script defer src=/r/fuse.min.js></script><script defer src=/r/en.search.min.fecd5084e60d197046005f39d360fc65e2939250cfcaaff80ee3545ecec0c140.js integrity="sha256-/s1QhOYNGXBGAF8502D8ZeKTklDPyq/4DuNUXs7AwUA=" crossorigin=anonymous></script><script defer src=/r/sw.min.9e3a83f0b071ebe0141a16a33db93faadb2bdf712473a218febeed35ed243c08.js integrity="sha256-njqD8LBx6+AUGhajPbk/qtsr33Ekc6IY/r7tNe0kPAg=" crossorigin=anonymous></script><link rel=preload href=/r/katex/fonts/KaTeX_Main-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/katex/fonts/KaTeX_Main-Bold.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/katex/fonts/KaTeX_Main-Italic.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/katex/fonts/KaTeX_Math-Italic.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/katex/fonts/KaTeX_Size2-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/katex/fonts/KaTeX_Size3-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/fonts/roboto-v27-latin-regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/r/fonts/roboto-v27-latin-700.woff2 as=font type=font/woff2 crossorigin=anonymous></head><body dir=ltr class="book-kind-page book-type-notes"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/r/><span>My Notes</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class=flex><a role=button><img src=/r/icons/translate.svg class=book-icon alt=Languages>
English
</a><img src=/r/icons/chevron-right.svg class=book-icon alt=Expand></label><ul></ul></li></ul><ul><li class=book-section-flat><a>Notes</a><ul><li class=book-section-flat><input type=checkbox id=section-f04c181c9b16a37431fe06303d58b7a0 class=toggle>
<label for=section-f04c181c9b16a37431fe06303d58b7a0 class=flex><a href=/r/notes/UWAA545/>Computational Methods For Plasmas</a>
<img src=/r/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/r/notes/UWAA545/01-syllabus/>Syllabus</a></li><li><a href=/r/notes/UWAA545/02-plasma-models/>Plasma Models</a></li><li><a href=/r/notes/UWAA545/03-pic-method/>Particle in Cell Model</a></li><li><a href=/r/notes/UWAA545/04-pic-example/>PIC - Example Implementation</a></li><li><a href=/r/notes/UWAA545/05-electrodynamic-pic/>Multidimensional Electrodynamic PIC</a></li><li><a href=/r/notes/UWAA545/06-fluid-models/>Fluid Models for Plasmas</a></li><li><a href=/r/notes/UWAA545/07-finite-difference-models/>Finite Difference Methods for MHD</a></li><li><a href=/r/notes/UWAA545/08-mhd-equilibrium/>MHD Equilibrium Calculations</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-b6bdf3598cf4214623cd2f8ff7b6e0f2 class=toggle>
<label for=section-b6bdf3598cf4214623cd2f8ff7b6e0f2 class=flex><a href=/r/notes/UWAA560/>Plasma Diagnostics</a>
<img src=/r/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/r/notes/UWAA560/01-syllabus/>Syllabus</a></li><li><a href=/r/notes/UWAA560/02-diagnostic-considerations/>General Diagnostic Considerations</a></li><li><a href=/r/notes/UWAA560/03-magnetic-field-diagnostics/>Magnetic Field Diagnostics</a></li><li><a href=/r/notes/UWAA560/04-electrostatic-diagnostics/>Electrostatic Diagnostics</a></li><li><a href=/r/notes/UWAA560/05-index-of-refraction-measurements/>Index of Refraction Measurements</a></li><li><a href=/r/notes/UWAA560/06-spectroscopic-measurements/>Spectroscopic Measurements</a></li><li><a href=/r/notes/UWAA560/90-student-lectures/>Student Lectures</a></li><li><a href=/r/notes/UWAA560/91-zeeman-spectroscopy/>My class lecture</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-5b051410be8cdb0f46ad32fc2ad5a20d class=toggle>
<label for=section-5b051410be8cdb0f46ad32fc2ad5a20d class=flex><a href=/r/notes/UWAA558/>MHD Theory</a>
<img src=/r/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/r/notes/UWAA558/01-syllabus/>Syllabus</a></li><li><a href=/r/notes/UWAA558/02-plasma-models/>Plasma Models</a></li><li><a href=/r/notes/UWAA558/03-plasma-fluid-model/>Plasma Fluid Model</a></li><li><a href=/r/notes/UWAA558/04-two-fluid-plasma-model/>Two-Fluid Plasma Model</a></li><li><a href=/r/notes/UWAA558/05-mhd-model/>Magnetohydrodynamic (MHD) Model</a></li><li><a href=/r/notes/UWAA558/06-boundary-conditions/>Boundary Conditions</a></li><li><a href=/r/notes/UWAA558/07-equilibrium-for-fusion/>Equilibrium for Fusion</a></li><li><a href=/r/notes/UWAA558/08-1d-equilibria/>1-D Equilibria</a></li><li><a href=/r/notes/UWAA558/09-2d-equilibria/>2D Equilibria</a></li><li><a href=/r/notes/UWAA558/10-equilibrium-of-3d-configurations/>Equilibrium of 3D Configurations</a></li><li><a href=/r/notes/UWAA558/11-mhd-stability/>MHD Stability</a></li><li><a href=/r/notes/UWAA558/formulary/>Formulary</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-c3201a1057283cb12ab09a42fe89bfb2 class=toggle checked>
<label for=section-c3201a1057283cb12ab09a42fe89bfb2 class=flex><a href=/r/notes/research/>Research Notes</a>
<img src=/r/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/r/notes/research/apollo/ class=active>Apollo dynamic tuning framework for RAJA</a></li><li><a href=/r/notes/research/dgh-datta/>Electrodynamic Dory-Guest-Harris Instability</a></li><li><a href=/r/notes/research/install-tricks/>Installation tricks</a></li><li><a href=/r/notes/research/valgrind/>Valgrind</a></li><li><a href=/r/notes/research/warpxm-101/>WARPXM 101 - Getting Started</a></li><li><a href=/r/notes/research/warpxm-102/>WARPXM 102 - Code Structure</a></li><li><a href=/r/notes/research/warpxm-201/>WARPXM 201 - Unstructured Geometry</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-e5101c35c8277102365bd86ab3e99a0d class=toggle>
<label for=section-e5101c35c8277102365bd86ab3e99a0d class=flex><a href=/r/notes/UWAMATH567/>Applied Complex Analysis</a>
<img src=/r/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/r/notes/UWAMATH567/01-overview/>Overview</a></li><li><a href=/r/notes/UWAMATH567/02-complex-numbers/>Complex Numbers</a></li><li><a href=/r/notes/UWAMATH567/03-analytic-functions/>Analytic Functions and Integration</a></li><li><a href=/r/notes/UWAMATH567/04-series/>Sequences, series, and singularities</a></li><li><a href=/r/notes/UWAMATH567/05-residue-calculus/>Residue calculus and applications of contour integration</a></li><li><a href=/r/notes/UWAMATH567/06-real-integrals/>Real Integrals</a></li><li><a href=/r/notes/UWAMATH567/07-integrals-of-multivalued-functions/>Integrals of Multivalued Functions</a></li><li><a href=/r/notes/UWAMATH567/08-fourier-transform/>Fourier Transforms and Laplace Transforms</a></li><li><a href=/r/notes/UWAMATH567/09-conformal-mapping/>Conformal Mappings</a></li><li><a href=/r/notes/UWAMATH567/10-fluid-flow/>Fluid Flow</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-34991d35561e8d266d64d5d323e97c7a class=toggle>
<label for=section-34991d35561e8d266d64d5d323e97c7a class=flex><a href=/r/notes/UWAA557/>Physics of Fusion Plasmas</a>
<img src=/r/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/r/notes/UWAA557/ch10-0/>Rules of thumb</a></li><li><a href=/r/notes/UWAA557/ch10-1/>Statistical Mechanics</a></li><li><a href=/r/notes/UWAA557/ch10-2/>Review of E&amp;M</a></li><li><a href=/r/notes/UWAA557/ch10-3/>Lagrange Multipliers</a></li><li><a href=/r/notes/UWAA557/ch11-1/>Wall-supported Plasma</a></li><li><a href=/r/notes/UWAA557/ch11-2/>Collisions</a></li><li><a href=/r/notes/UWAA557/ch11-3/>Oscillations</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-7c7b4e4d4494a744744faedd969cb670 class=toggle>
<label for=section-7c7b4e4d4494a744744faedd969cb670 class=flex><a href=/r/notes/UWAA543/>Computational CFD</a>
<img src=/r/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/r/notes/UWAA543/ch20-1/>Introduction to Computational CFD</a></li><li><a href=/r/notes/UWAA543/ch20-2/>Governing Equations</a></li><li><a href=/r/notes/UWAA543/ch20-3/>Reduced Models</a></li><li><a href=/r/notes/UWAA543/ch20-4/>Equation Types</a></li><li><a href=/r/notes/UWAA543/ch20-5/>Panel Method</a></li><li><a href=/r/notes/UWAA543/ch21-1/>Finite Difference Algorithms</a></li><li><a href=/r/notes/UWAA543/ch21-2/>Explicit Finite Difference Algorithms</a></li><li><a href=/r/notes/UWAA543/ch21-3/>Finite Difference and Finite Volume Methods</a></li><li><a href=/r/notes/UWAA543/ch21-4/>Implicit Algorithms</a></li><li><a href=/r/notes/UWAA543/ch21-5/>Numerical Boundary Conditions</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-e5f141895443fc824f58730f7904d483 class=toggle>
<label for=section-e5f141895443fc824f58730f7904d483 class=flex><a href=/r/notes/UWAA556/>Plasma Waves</a>
<img src=/r/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/r/notes/UWAA556/ch01-1/>Mathematical review</a></li><li><a href=/r/notes/UWAA556/ch02-1/>Plasma Waves in General Dielectric Media</a></li><li><a href=/r/notes/UWAA556/ch02-2/>Wave Properties in Cold Unmagnetized Plasma</a></li><li><a href=/r/notes/UWAA556/ch02-3/>Cold Magnetized Plasma Dispersion Relation</a></li><li><a href=/r/notes/UWAA556/ch02-4/>The CMA Diagram</a></li><li><a href=/r/notes/UWAA556/ch03-1/>Introduction to Kinetic Theory</a></li><li><a href=/r/notes/UWAA556/ch03-2/>Landau Damping</a></li><li><a href=/r/notes/UWAA556/ch03-3/>Waves in Hot Magnetized Plasma</a></li><li><a href=/r/notes/UWAA556/ch04-1/>Fluid stuff</a></li><li><a href=/r/notes/UWAA556/ch04-2/>Quasi-Linear Theory</a></li><li><a href=/r/notes/UWAA556/ch05-1/>Diffusion and Resistivity</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-3a2759a8b11b3422da800ed19897932a class=toggle>
<label for=section-3a2759a8b11b3422da800ed19897932a class=flex><a href=/r/notes/problems/>Worked Problems</a>
<img src=/r/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/r/notes/problems/gurnett/ch02/>Characteristic Parameters of a Plasma</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-05ac7760b68f0e0530d0e609833f6902 class=toggle>
<label for=section-05ac7760b68f0e0530d0e609833f6902 class=flex><a role=button>Scratch</a>
<img src=/r/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/r/notes/scratch/colors/>Adding Color</a></li><li><a href=/r/notes/scratch/crews2018/>Crews (2018)</a></li><li><a href=/r/notes/scratch/datta2021/>Datta (2021)</a></li><li><a href=/r/notes/scratch/drawing/>Drawing Diagrams</a></li><li><a href=/r/notes/scratch/goedbloed/>Goedbloed (2019)</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-c8688d5789736c2ae128963cf705a441 class=toggle>
<label for=section-c8688d5789736c2ae128963cf705a441 class=flex><a href=/r/notes/griffiths/>Griffiths Introduction to Electrodynamics</a>
<img src=/r/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/r/notes/griffiths/ch1-1/>(1.1) Vector Algebra</a></li><li><a href=/r/notes/griffiths/ch1-2/>(1.2) Differential Calculus</a></li><li><a href=/r/notes/griffiths/ch1-3/>(1.3) Integral Calculus</a></li><li><a href=/r/notes/griffiths/ch1-4/>(1.4) Curvilinear Coordinates</a></li><li><a href=/r/notes/griffiths/ch1-5/>(1.5) The Dirac Delta Function</a></li><li><a href=/r/notes/griffiths/ch1-6/>(1.6) The Theory of Vector Fields</a></li><li><a href=/r/notes/griffiths/ch2-1/>(2.1) The Electric Field</a></li><li><a href=/r/notes/griffiths/ch2-2/>(2.2) Divergence and Curl of Electrostatic Fields</a></li><li><a href=/r/notes/griffiths/ch2-3/>(2.3) Electric Potential</a></li><li><a href=/r/notes/griffiths/ch2-4/>(2.4) Work and Energy in Electrostatics</a></li><li><a href=/r/notes/griffiths/ch2-5/>(2.5) Conductors</a></li><li><a href=/r/notes/griffiths/ch3-1/>(3.1) Laplace's Equation</a></li><li><a href=/r/notes/griffiths/ch3-2/>(3.2) The Method of Images</a></li><li><a href=/r/notes/griffiths/ch3-3/>(3.3) Separation of Variables</a></li><li><a href=/r/notes/griffiths/ch3-4/>(3.4) Multipole Expansion</a></li><li><a href=/r/notes/griffiths/ch4-1/>(4.1) Polarization</a></li><li><a href=/r/notes/griffiths/ch4-2/>(4.2) The Field of a Polarized Object</a></li><li><a href=/r/notes/griffiths/ch4-3/>(4.3) The Electric Displacement</a></li><li><a href=/r/notes/griffiths/ch4-4/>(4.4) The Linear Dielectrics</a></li><li><a href=/r/notes/griffiths/ch5-1/>(5.1) The Lorentz Force Law</a></li><li><a href=/r/notes/griffiths/ch5-2/>(5.2) The Biot-Savart Law</a></li><li><a href=/r/notes/griffiths/ch5-3/>(5.3) The Divergence and Curl of B</a></li><li><a href=/r/notes/griffiths/ch5-4/>(5.4) Magnetic Vector Potential</a></li><li><a href=/r/notes/griffiths/ch6-1/>(6.1) Magnetization</a></li><li><a href=/r/notes/griffiths/ch6-2/>(6.2) The Field of a Magnetized Object</a></li><li><a href=/r/notes/griffiths/ch6-3/>(6.3) The Auxiliary Field H</a></li><li><a href=/r/notes/griffiths/ch6-4/>(6.4) Linear and Nonlinear Media</a></li><li><a href=/r/notes/griffiths/ch7-1/>(7.1) Electromotive Force</a></li><li><a href=/r/notes/griffiths/ch7-2/>(7.2) Electromagnetic Induction</a></li><li><a href=/r/notes/griffiths/ch7-3/>(7.3) Maxwell's Equations</a></li><li><a href=/r/notes/griffiths/ch8-0/>(8.0) Phys 544 Introduction</a></li><li><a href=/r/notes/griffiths/ch8-1/>(8.1) Charge and Energy</a></li><li><a href=/r/notes/griffiths/ch8-2/>(8.2) Momentum</a></li><li><a href=/r/notes/griffiths/ch9-1/>(9.1) Electromagnetic Waves in One Dimension</a></li><li><a href=/r/notes/griffiths/ch9-2/>(9.2) Wave Equation for E and B</a></li><li><a href=/r/notes/griffiths/ch9-3/>(9.3) Electromagnetic Waves in Matter</a></li><li><a href=/r/notes/griffiths/ch9-4/>(9.4) Electromagnetic Waves in Conductors</a></li><li><a href=/r/notes/griffiths/ch9-5/>(9.5) Guided Waves</a></li><li><a href=/r/notes/griffiths/ch10-1/>(10.1) Scalar and Vector Potentials</a></li><li><a href=/r/notes/griffiths/ch10-2/>(10.2) Retarded Potentials</a></li><li><a href=/r/notes/griffiths/ch10-3/>(10.3) Point Charges</a></li><li><a href=/r/notes/griffiths/ch11-1/>(11.1) Dipole Radiation</a></li><li><a href=/r/notes/griffiths/problems-ch3/>Solved Problems Ch3</a></li><li><a href=/r/notes/griffiths/problems-ch5/>Solved Problems Ch5</a></li><li><a href=/r/notes/griffiths/problems-ch7/>Solved Problems Ch7</a></li><li><a href=/r/notes/griffiths/problems-ch9/>Solved Problems Ch9</a></li></ul></li></ul></li></ul><ul class=book-menu-hugo><li><a href=https://github.com/Peppyhare/r target=_blank rel=noopener>Github</a></li><li><a href=https://themes.gohugo.io/hugo-book/ target=_blank rel=noopener>Hugo Themes</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/r/icons/menu.svg class=book-icon alt=Menu></label><h3>Apollo dynamic tuning framework for RAJA</h3><label for=toc-control></label></div></header><article class="markdown book-article"><p>Uri mentioned a project by David Beckingsale at LLNL called &ldquo;Apollo&rdquo; that attempts to tune kernel parameters at runtime in order to optimize for the available hardware. It&rsquo;s especially for codes with adaptive capabalities (like adaptive mesh refinement) in which the runtime characteristics of the compute kernels tend to be very input dependent.</p><p>This is the main paper they put out: <a href=https://computing.llnl.gov/sites/default/files/Apollo-Fast-Lightweight-Dynamic-Tuning-Data-Dependent-Code-LLNL-paper_0.pdf>https://computing.llnl.gov/sites/default/files/Apollo-Fast-Lightweight-Dynamic-Tuning-Data-Dependent-Code-LLNL-paper_0.pdf</a></p><p>And here&rsquo;s the github repository: <a href=https://github.com/LLNL/apollo>https://github.com/LLNL/apollo</a></p><p>The approach they take is: At runtime, for each kernel execution apollo collects the runtime and a &ldquo;feature vector&rdquo; describing various features of the kernel. These features include:</p><ul><li>Parameters passed to the RAJA <code>forall</code></li><li>Instruction features gathered from the kernel body</li><li>Runtime measurements</li><li>Optional features specified by the developer</li></ul><p align=center><img alt=img/research/apollo-features.png src=/r/img/research/apollo-features.png width=400></p><p>To be able to change the execution policy at runtime (which is generally not possible in RAJA), they added a RAJA extension</p><p>I&rsquo;d really like to see it in action, so let&rsquo;s see if we can get a simple project using their framework to compile. We can eventually get Claude to spit out something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;iostream&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;iomanip&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;vector&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;memory&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;cmath&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;chrono&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;algorithm&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;numeric&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;random&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;cstring&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;thread&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;RAJA/RAJA.hpp&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;apollo/Apollo.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;apollo/Region.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;kernels.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Define execution policies for CPU
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> sequential_policy <span style=color:#f92672>=</span> RAJA<span style=color:#f92672>::</span>seq_exec;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef RAJA_ENABLE_OPENMP
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> omp_policy_1 <span style=color:#f92672>=</span> RAJA<span style=color:#f92672>::</span>omp_parallel_for_exec;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> omp_policy_static <span style=color:#f92672>=</span> RAJA<span style=color:#f92672>::</span>omp_parallel_for_static_exec<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>16</span><span style=color:#f92672>&gt;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> omp_policy_dynamic <span style=color:#f92672>=</span> RAJA<span style=color:#f92672>::</span>omp_parallel_for_dynamic_exec<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>8</span><span style=color:#f92672>&gt;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> omp_policy_guided <span style=color:#f92672>=</span> RAJA<span style=color:#f92672>::</span>omp_parallel_for_guided_exec<span style=color:#f92672>&lt;&gt;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Policy list for Apollo to choose from
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> CPUPolicyList <span style=color:#f92672>=</span> RAJA<span style=color:#f92672>::</span>list<span style=color:#f92672>&lt;</span>
</span></span><span style=display:flex><span>    sequential_policy,
</span></span><span style=display:flex><span>    omp_policy_1,
</span></span><span style=display:flex><span>    omp_policy_static,
</span></span><span style=display:flex><span>    omp_policy_dynamic,
</span></span><span style=display:flex><span>    omp_policy_guided
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>constexpr</span> <span style=color:#66d9ef>int</span> NUM_POLICIES <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> policy_names[] <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Sequential&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;OpenMP Default&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;OpenMP Static-16&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;OpenMP Dynamic-8&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;OpenMP Guided&#34;</span>
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#75715e>#else
</span></span></span><span style=display:flex><span><span style=color:#75715e>// If OpenMP is not available, use only sequential
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> CPUPolicyList <span style=color:#f92672>=</span> RAJA<span style=color:#f92672>::</span>list<span style=color:#f92672>&lt;</span>sequential_policy<span style=color:#f92672>&gt;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>constexpr</span> <span style=color:#66d9ef>int</span> NUM_POLICIES <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> policy_names[] <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;Sequential&#34;</span>};
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> apollo_demo {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Timer utility
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Timer</span> {
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>chrono<span style=color:#f92672>::</span>high_resolution_clock<span style=color:#f92672>::</span>time_point start_time;
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>chrono<span style=color:#f92672>::</span>high_resolution_clock<span style=color:#f92672>::</span>time_point end_time;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> start() {
</span></span><span style=display:flex><span>        start_time <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>chrono<span style=color:#f92672>::</span>high_resolution_clock<span style=color:#f92672>::</span>now();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>stop</span>() {
</span></span><span style=display:flex><span>        end_time <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>chrono<span style=color:#f92672>::</span>high_resolution_clock<span style=color:#f92672>::</span>now();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> <span style=color:#a6e22e>getElapsedMilliseconds</span>() <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>auto</span> duration <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>chrono<span style=color:#f92672>::</span>duration_cast<span style=color:#f92672>&lt;</span>std<span style=color:#f92672>::</span>chrono<span style=color:#f92672>::</span>microseconds<span style=color:#f92672>&gt;</span>(end_time <span style=color:#f92672>-</span> start_time);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> duration.count() <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000.0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Benchmark runner for a specific kernel
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>KernelBenchmark</span> {
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>unique_ptr<span style=color:#f92672>&lt;</span>KernelBase<span style=color:#f92672>&gt;</span> kernel;
</span></span><span style=display:flex><span>    Apollo<span style=color:#f92672>::</span>Region<span style=color:#f92672>*</span> region;
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>string kernel_name;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> use_apollo;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    KernelBenchmark(<span style=color:#66d9ef>const</span> std<span style=color:#f92672>::</span>string<span style=color:#f92672>&amp;</span> name, <span style=color:#66d9ef>bool</span> enable_apollo <span style=color:#f92672>=</span> true)
</span></span><span style=display:flex><span>        <span style=color:#f92672>:</span> kernel_name(name), use_apollo(enable_apollo), region(<span style=color:#66d9ef>nullptr</span>) {
</span></span><span style=display:flex><span>        kernel <span style=color:#f92672>=</span> createKernel(name);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>kernel) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> std<span style=color:#f92672>::</span>runtime_error(<span style=color:#e6db74>&#34;Unknown kernel: &#34;</span> <span style=color:#f92672>+</span> name);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (use_apollo) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Create Apollo region with 5 features (from KernelFeatures)
</span></span></span><span style=display:flex><span>            region <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Apollo<span style=color:#f92672>::</span>Region(
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>5</span>,  <span style=color:#75715e>// number of features
</span></span></span><span style=display:flex><span>                kernel<span style=color:#f92672>-&gt;</span>getName(),
</span></span><span style=display:flex><span>                NUM_POLICIES,
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>50</span>  <span style=color:#75715e>// minimum training data before making predictions
</span></span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>~</span>KernelBenchmark() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (region) <span style=color:#66d9ef>delete</span> region;
</span></span><span style=display:flex><span>        cleanup();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cleanup</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (region) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>delete</span> region;
</span></span><span style=display:flex><span>            region <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> KernelType<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> runWithApollo(KernelType<span style=color:#f92672>*</span> k, <span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>region) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> std<span style=color:#f92672>::</span>runtime_error(<span style=color:#e6db74>&#34;Apollo not enabled for this benchmark&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Extract features for Apollo
</span></span></span><span style=display:flex><span>        KernelFeatures features <span style=color:#f92672>=</span> k<span style=color:#f92672>-&gt;</span>extractFeatures(config);
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>float</span><span style=color:#f92672>&gt;</span> feature_vec <span style=color:#f92672>=</span> features.toVector();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Start Apollo region
</span></span></span><span style=display:flex><span>        Apollo<span style=color:#f92672>::</span>RegionContext<span style=color:#f92672>*</span> context <span style=color:#f92672>=</span> region<span style=color:#f92672>-&gt;</span>begin(feature_vec);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Get policy recommendation from Apollo
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> policy_idx <span style=color:#f92672>=</span> region<span style=color:#f92672>-&gt;</span>getPolicyIndex(context);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Timer timer;
</span></span><span style=display:flex><span>        timer.start();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Execute with selected policy
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span>(policy_idx) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                k<span style=color:#f92672>-&gt;</span><span style=color:#66d9ef>template</span> execute<span style=color:#f92672>&lt;</span>sequential_policy<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef RAJA_ENABLE_OPENMP
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                k<span style=color:#f92672>-&gt;</span><span style=color:#66d9ef>template</span> execute<span style=color:#f92672>&lt;</span>omp_policy_1<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                k<span style=color:#f92672>-&gt;</span><span style=color:#66d9ef>template</span> execute<span style=color:#f92672>&lt;</span>omp_policy_static<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                k<span style=color:#f92672>-&gt;</span><span style=color:#66d9ef>template</span> execute<span style=color:#f92672>&lt;</span>omp_policy_dynamic<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>4</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                k<span style=color:#f92672>-&gt;</span><span style=color:#66d9ef>template</span> execute<span style=color:#f92672>&lt;</span>omp_policy_guided<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                k<span style=color:#f92672>-&gt;</span><span style=color:#66d9ef>template</span> execute<span style=color:#f92672>&lt;</span>sequential_policy<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        timer.stop();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>double</span> elapsed <span style=color:#f92672>=</span> timer.getElapsedMilliseconds();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// End Apollo region with performance metric
</span></span></span><span style=display:flex><span>        region<span style=color:#f92672>-&gt;</span>end(context, elapsed);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (policy_idx <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> policy_idx <span style=color:#f92672>&lt;</span> NUM_POLICIES) {
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  Apollo selected: &#34;</span> <span style=color:#f92672>&lt;&lt;</span> policy_names[policy_idx]
</span></span><span style=display:flex><span>                      <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34; (policy &#34;</span> <span style=color:#f92672>&lt;&lt;</span> policy_idx <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;)&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> elapsed;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> KernelType, <span style=color:#66d9ef>typename</span> ExecPolicy<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> runWithPolicy(KernelType<span style=color:#f92672>*</span> k) {
</span></span><span style=display:flex><span>        Timer timer;
</span></span><span style=display:flex><span>        timer.start();
</span></span><span style=display:flex><span>        k<span style=color:#f92672>-&gt;</span><span style=color:#66d9ef>template</span> execute<span style=color:#f92672>&lt;</span>ExecPolicy<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>        timer.stop();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> timer.getElapsedMilliseconds();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>runBenchmark</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config, <span style=color:#66d9ef>int</span> iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>) {
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>=== Running &#34;</span> <span style=color:#f92672>&lt;&lt;</span> kernel_name <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34; Kernel ===&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Problem size: &#34;</span> <span style=color:#f92672>&lt;&lt;</span> config.size <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Iterations: &#34;</span> <span style=color:#f92672>&lt;&lt;</span> iterations <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        kernel<span style=color:#f92672>-&gt;</span>initialize(config);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>double</span><span style=color:#f92672>&gt;</span> times;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> iter <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; iter <span style=color:#f92672>&lt;</span> iterations; <span style=color:#f92672>++</span>iter) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>double</span> elapsed <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (use_apollo) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>VectorAddKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithApollo(k, config);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>DaxpyKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithApollo(k, config);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>MatVecKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithApollo(k, config);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>Stencil1DKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithApollo(k, config);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>ReductionKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithApollo(k, config);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>SpMVKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithApollo(k, config);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>IndirectKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithApollo(k, config);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Run with default policy (sequential)
</span></span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>VectorAddKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithPolicy<span style=color:#f92672>&lt;</span>VectorAddKernel, sequential_policy<span style=color:#f92672>&gt;</span>(k);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>DaxpyKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithPolicy<span style=color:#f92672>&lt;</span>DaxpyKernel, sequential_policy<span style=color:#f92672>&gt;</span>(k);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>MatVecKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithPolicy<span style=color:#f92672>&lt;</span>MatVecKernel, sequential_policy<span style=color:#f92672>&gt;</span>(k);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>Stencil1DKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithPolicy<span style=color:#f92672>&lt;</span>Stencil1DKernel, sequential_policy<span style=color:#f92672>&gt;</span>(k);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>ReductionKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithPolicy<span style=color:#f92672>&lt;</span>ReductionKernel, sequential_policy<span style=color:#f92672>&gt;</span>(k);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>SpMVKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithPolicy<span style=color:#f92672>&lt;</span>SpMVKernel, sequential_policy<span style=color:#f92672>&gt;</span>(k);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>*</span> k <span style=color:#f92672>=</span> <span style=color:#66d9ef>dynamic_cast</span><span style=color:#f92672>&lt;</span>IndirectKernel<span style=color:#f92672>*&gt;</span>(kernel.get())) {
</span></span><span style=display:flex><span>                    elapsed <span style=color:#f92672>=</span> runWithPolicy<span style=color:#f92672>&lt;</span>IndirectKernel, sequential_policy<span style=color:#f92672>&gt;</span>(k);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            times.push_back(elapsed);
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  Iteration &#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>setw(<span style=color:#ae81ff>2</span>) <span style=color:#f92672>&lt;&lt;</span> iter <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                      <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;: &#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>fixed <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>setprecision(<span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>                      <span style=color:#f92672>&lt;&lt;</span> elapsed <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34; ms&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Compute statistics
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>double</span> avg_time <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>accumulate(times.begin(), times.end(), <span style=color:#ae81ff>0.0</span>) <span style=color:#f92672>/</span> times.size();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>double</span> min_time <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>std<span style=color:#f92672>::</span>min_element(times.begin(), times.end());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>double</span> max_time <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>std<span style=color:#f92672>::</span>max_element(times.begin(), times.end());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Statistics:&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  Average: &#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>fixed <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>setprecision(<span style=color:#ae81ff>3</span>) <span style=color:#f92672>&lt;&lt;</span> avg_time <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34; ms&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  Min:     &#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>fixed <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>setprecision(<span style=color:#ae81ff>3</span>) <span style=color:#f92672>&lt;&lt;</span> min_time <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34; ms&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  Max:     &#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>fixed <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>setprecision(<span style=color:#ae81ff>3</span>) <span style=color:#f92672>&lt;&lt;</span> max_time <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34; ms&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        kernel<span style=color:#f92672>-&gt;</span>cleanup();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>trainApollo</span>(<span style=color:#66d9ef>int</span> step) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (region) {
</span></span><span style=display:flex><span>            region<span style=color:#f92672>-&gt;</span>train(step);
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Apollo training triggered at step &#34;</span> <span style=color:#f92672>&lt;&lt;</span> step <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cleanupRegion</span>() {
</span></span><span style=display:flex><span>        cleanup();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Scenario runner - runs different problem configurations
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ScenarioRunner</span> {
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    Apollo<span style=color:#f92672>*</span> apollo;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> verbose;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    ScenarioRunner(<span style=color:#66d9ef>bool</span> verbose_mode <span style=color:#f92672>=</span> false)
</span></span><span style=display:flex><span>        <span style=color:#f92672>:</span> apollo(Apollo<span style=color:#f92672>::</span>instance()), verbose(verbose_mode) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>runAdaptiveScenario</span>() {
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>string(<span style=color:#ae81ff>60</span>, <span style=color:#e6db74>&#39;=&#39;</span>) <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;ADAPTIVE SCENARIO: Apollo learns optimal policies&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>string(<span style=color:#ae81ff>60</span>, <span style=color:#e6db74>&#39;=&#39;</span>) <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Create benchmarks for different kernels
</span></span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span>std<span style=color:#f92672>::</span>unique_ptr<span style=color:#f92672>&lt;</span>KernelBenchmark<span style=color:#f92672>&gt;&gt;</span> benchmarks;
</span></span><span style=display:flex><span>        benchmarks.push_back(std<span style=color:#f92672>::</span>make_unique<span style=color:#f92672>&lt;</span>KernelBenchmark<span style=color:#f92672>&gt;</span>(<span style=color:#e6db74>&#34;VectorAdd&#34;</span>, true));
</span></span><span style=display:flex><span>        benchmarks.push_back(std<span style=color:#f92672>::</span>make_unique<span style=color:#f92672>&lt;</span>KernelBenchmark<span style=color:#f92672>&gt;</span>(<span style=color:#e6db74>&#34;DAXPY&#34;</span>, true));
</span></span><span style=display:flex><span>        benchmarks.push_back(std<span style=color:#f92672>::</span>make_unique<span style=color:#f92672>&lt;</span>KernelBenchmark<span style=color:#f92672>&gt;</span>(<span style=color:#e6db74>&#34;Stencil1D&#34;</span>, true));
</span></span><span style=display:flex><span>        benchmarks.push_back(std<span style=color:#f92672>::</span>make_unique<span style=color:#f92672>&lt;</span>KernelBenchmark<span style=color:#f92672>&gt;</span>(<span style=color:#e6db74>&#34;Reduction&#34;</span>, true));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Different problem configurations to test adaptation
</span></span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span>ProblemConfig<span style=color:#f92672>&gt;</span> configs;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Small problems
</span></span></span><span style=display:flex><span>        ProblemConfig small_config;
</span></span><span style=display:flex><span>        small_config.size <span style=color:#f92672>=</span> <span style=color:#ae81ff>10000</span>;
</span></span><span style=display:flex><span>        small_config.iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>        configs.push_back(small_config);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Medium problems
</span></span></span><span style=display:flex><span>        ProblemConfig medium_config;
</span></span><span style=display:flex><span>        medium_config.size <span style=color:#f92672>=</span> <span style=color:#ae81ff>100000</span>;
</span></span><span style=display:flex><span>        medium_config.iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>        configs.push_back(medium_config);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Large problems
</span></span></span><span style=display:flex><span>        ProblemConfig large_config;
</span></span><span style=display:flex><span>        large_config.size <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000000</span>;
</span></span><span style=display:flex><span>        large_config.iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>        configs.push_back(large_config);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Very large problems
</span></span></span><span style=display:flex><span>        ProblemConfig xlarge_config;
</span></span><span style=display:flex><span>        xlarge_config.size <span style=color:#f92672>=</span> <span style=color:#ae81ff>10000000</span>;
</span></span><span style=display:flex><span>        xlarge_config.iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>        configs.push_back(xlarge_config);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> global_step <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Run exploration phase
</span></span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>--- EXPLORATION PHASE ---&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Apollo explores different policies...&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (size_t config_idx <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; config_idx <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span>; <span style=color:#f92672>++</span>config_idx) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>&amp;</span> benchmark : benchmarks) {
</span></span><span style=display:flex><span>                benchmark<span style=color:#f92672>-&gt;</span>runBenchmark(configs[config_idx], <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>                global_step<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Trigger training
</span></span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>--- TRAINING PHASE ---&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        apollo<span style=color:#f92672>-&gt;</span>train(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Apollo has trained models based on exploration data&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Run exploitation phase
</span></span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>--- EXPLOITATION PHASE ---&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Apollo uses learned models to select optimal policies...&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (size_t config_idx <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>; config_idx <span style=color:#f92672>&lt;</span> configs.size(); <span style=color:#f92672>++</span>config_idx) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>&amp;</span> benchmark : benchmarks) {
</span></span><span style=display:flex><span>                benchmark<span style=color:#f92672>-&gt;</span>runBenchmark(configs[config_idx], <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>                global_step<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Periodically retrain to adapt
</span></span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (global_step <span style=color:#f92672>%</span> <span style=color:#ae81ff>10</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>                    apollo<span style=color:#f92672>-&gt;</span>train(global_step <span style=color:#f92672>/</span> <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Clean up benchmarks explicitly
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>&amp;</span> benchmark : benchmarks) {
</span></span><span style=display:flex><span>            benchmark<span style=color:#f92672>-&gt;</span>cleanupRegion();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        benchmarks.clear();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>runComparisonScenario</span>() {
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>string(<span style=color:#ae81ff>60</span>, <span style=color:#e6db74>&#39;=&#39;</span>) <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;COMPARISON SCENARIO: Apollo vs Fixed Policies&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>string(<span style=color:#ae81ff>60</span>, <span style=color:#e6db74>&#39;=&#39;</span>) <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ProblemConfig config;
</span></span><span style=display:flex><span>        config.size <span style=color:#f92672>=</span> <span style=color:#ae81ff>5000000</span>;
</span></span><span style=display:flex><span>        config.iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>--- Running with Apollo (adaptive) ---&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        KernelBenchmark apollo_bench(<span style=color:#e6db74>&#34;VectorAdd&#34;</span>, true);
</span></span><span style=display:flex><span>        apollo_bench.runBenchmark(config, <span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Train after exploration
</span></span></span><span style=display:flex><span>        apollo<span style=color:#f92672>-&gt;</span>train(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>--- Running with Apollo (after training) ---&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        apollo_bench.runBenchmark(config, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Clean up benchmark
</span></span></span><span style=display:flex><span>        apollo_bench.cleanupRegion();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef RAJA_ENABLE_OPENMP
</span></span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>--- Running with fixed Sequential policy ---&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        KernelBenchmark seq_bench(<span style=color:#e6db74>&#34;VectorAdd&#34;</span>, false);
</span></span><span style=display:flex><span>        seq_bench.runBenchmark(config, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>        seq_bench.cleanupRegion();
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>runDataDependentScenario</span>() {
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>string(<span style=color:#ae81ff>60</span>, <span style=color:#e6db74>&#39;=&#39;</span>) <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;DATA-DEPENDENT SCENARIO: Apollo adapts to data patterns&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>string(<span style=color:#ae81ff>60</span>, <span style=color:#e6db74>&#39;=&#39;</span>) <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        KernelBenchmark spmv_bench(<span style=color:#e6db74>&#34;SpMV&#34;</span>, true);
</span></span><span style=display:flex><span>        KernelBenchmark indirect_bench(<span style=color:#e6db74>&#34;Indirect&#34;</span>, true);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Test with different sparsity levels
</span></span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>double</span><span style=color:#f92672>&gt;</span> sparsity_levels <span style=color:#f92672>=</span> {<span style=color:#ae81ff>0.01</span>, <span style=color:#ae81ff>0.1</span>, <span style=color:#ae81ff>0.5</span>, <span style=color:#ae81ff>0.9</span>, <span style=color:#ae81ff>0.99</span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>double</span> sparsity : sparsity_levels) {
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>--- Sparsity Level: &#34;</span> <span style=color:#f92672>&lt;&lt;</span> (sparsity <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span>) <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;% ---&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            ProblemConfig config;
</span></span><span style=display:flex><span>            config.size <span style=color:#f92672>=</span> <span style=color:#ae81ff>100000</span>;
</span></span><span style=display:flex><span>            config.sparsity <span style=color:#f92672>=</span> sparsity;
</span></span><span style=display:flex><span>            config.iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            spmv_bench.runBenchmark(config, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Train after each sparsity level
</span></span></span><span style=display:flex><span>            apollo<span style=color:#f92672>-&gt;</span>train(<span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span>(sparsity <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span>));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Clean up benchmarks
</span></span></span><span style=display:flex><span>        spmv_bench.cleanupRegion();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Test with different access patterns
</span></span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>--- Testing Indirect Access Patterns ---&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ProblemConfig seq_config;
</span></span><span style=display:flex><span>        seq_config.size <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000000</span>;
</span></span><span style=display:flex><span>        seq_config.use_indirect <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>        seq_config.iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ProblemConfig rand_config;
</span></span><span style=display:flex><span>        rand_config.size <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000000</span>;
</span></span><span style=display:flex><span>        rand_config.use_indirect <span style=color:#f92672>=</span> true;
</span></span><span style=display:flex><span>        rand_config.iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Sequential access pattern:&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        indirect_bench.runBenchmark(seq_config, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Random access pattern:&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        indirect_bench.runBenchmark(rand_config, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Clean up benchmark
</span></span></span><span style=display:flex><span>        indirect_bench.cleanupRegion();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>} <span style=color:#75715e>// namespace apollo_demo
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Main function
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span><span style=color:#f92672>**</span> argv) {
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Apollo-RAJA CPU Demonstration&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;==============================&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Print configuration
</span></span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Configuration:&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  Number of policies: &#34;</span> <span style=color:#f92672>&lt;&lt;</span> NUM_POLICIES <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  Available policies:&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> NUM_POLICIES; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;    &#34;</span> <span style=color:#f92672>&lt;&lt;</span> i <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;: &#34;</span> <span style=color:#f92672>&lt;&lt;</span> policy_names[i] <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef RAJA_ENABLE_OPENMP
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> num_threads <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e>#pragma omp parallel
</span></span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>#pragma omp single
</span></span></span><span style=display:flex><span>        num_threads <span style=color:#f92672>=</span> omp_get_num_threads();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  OpenMP threads: &#34;</span> <span style=color:#f92672>&lt;&lt;</span> num_threads <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span><span style=color:#75715e>#else
</span></span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  OpenMP: DISABLED&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Check for Apollo environment variables
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> policy_model <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>getenv(<span style=color:#e6db74>&#34;APOLLO_POLICY_MODEL&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (policy_model) {
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  Apollo Policy Model: &#34;</span> <span style=color:#f92672>&lt;&lt;</span> policy_model <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  Apollo Policy Model: Default (Static)&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  Tip: Set APOLLO_POLICY_MODEL env var to enable tuning&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  Example: APOLLO_POLICY_MODEL=DecisionTree,explore=RoundRobin,max_depth=4&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> train_period <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>getenv(<span style=color:#e6db74>&#34;APOLLO_GLOBAL_TRAIN_PERIOD&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (train_period) {
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  Apollo Global Train Period: &#34;</span> <span style=color:#f92672>&lt;&lt;</span> train_period <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Parse command line arguments
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> run_all <span style=color:#f92672>=</span> true;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> run_adaptive <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> run_comparison <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> run_data_dependent <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; i <span style=color:#f92672>&lt;</span> argc; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>string arg(argv[i]);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (arg <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;--adaptive&#34;</span>) {
</span></span><span style=display:flex><span>            run_all <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>            run_adaptive <span style=color:#f92672>=</span> true;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (arg <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;--comparison&#34;</span>) {
</span></span><span style=display:flex><span>            run_all <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>            run_comparison <span style=color:#f92672>=</span> true;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (arg <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;--data-dependent&#34;</span>) {
</span></span><span style=display:flex><span>            run_all <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>            run_data_dependent <span style=color:#f92672>=</span> true;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (arg <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;--help&#34;</span> <span style=color:#f92672>||</span> arg <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;-h&#34;</span>) {
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Usage: &#34;</span> <span style=color:#f92672>&lt;&lt;</span> argv[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34; [options]&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Options:&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  --adaptive        Run adaptive scenario&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  --comparison      Run comparison scenario&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  --data-dependent  Run data-dependent scenario&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  --help, -h        Show this help message&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Environment variables:&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  APOLLO_POLICY_MODEL       Set Apollo tuning model&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  APOLLO_GLOBAL_TRAIN_PERIOD  Set automatic training period&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  APOLLO_TRACE_CSV          Enable CSV tracing (0/1)&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>            std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;  APOLLO_STORE_MODELS       Store/load trained models (0/1)&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Create scenario runner
</span></span></span><span style=display:flex><span>    apollo_demo<span style=color:#f92672>::</span>ScenarioRunner runner(false);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Run selected scenarios
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (run_all <span style=color:#f92672>||</span> run_adaptive) {
</span></span><span style=display:flex><span>        runner.runAdaptiveScenario();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (run_all <span style=color:#f92672>||</span> run_comparison) {
</span></span><span style=display:flex><span>        runner.runComparisonScenario();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (run_all <span style=color:#f92672>||</span> run_data_dependent) {
</span></span><span style=display:flex><span>        runner.runDataDependentScenario();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>string(<span style=color:#ae81ff>60</span>, <span style=color:#e6db74>&#39;=&#39;</span>) <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Apollo-RAJA CPU Demonstration Complete&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>string(<span style=color:#ae81ff>60</span>, <span style=color:#e6db74>&#39;=&#39;</span>) <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Give some time for cleanup
</span></span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>this_thread<span style=color:#f92672>::</span>sleep_for(std<span style=color:#f92672>::</span>chrono<span style=color:#f92672>::</span>milliseconds(<span style=color:#ae81ff>100</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>with a wide variety of compute kernels defined in <code>kernels.h</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#75715e>// kernels.h
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>#ifndef APOLLO_RAJA_DEMO_KERNELS_H
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define APOLLO_RAJA_DEMO_KERNELS_H
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;vector&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;memory&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;cmath&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;algorithm&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;RAJA/RAJA.hpp&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> apollo_demo {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Structure to hold problem configuration
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ProblemConfig</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> size;              <span style=color:#75715e>// Problem size
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> iterations;        <span style=color:#75715e>// Number of iterations
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> sparsity;       <span style=color:#75715e>// Sparsity level (0.0 to 1.0)
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> stencil_size;      <span style=color:#75715e>// Size of stencil pattern
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> use_indirect;     <span style=color:#75715e>// Use indirect access pattern
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ProblemConfig()
</span></span><span style=display:flex><span>        <span style=color:#f92672>:</span> size(<span style=color:#ae81ff>1000000</span>), iterations(<span style=color:#ae81ff>100</span>), sparsity(<span style=color:#ae81ff>0.0</span>),
</span></span><span style=display:flex><span>          stencil_size(<span style=color:#ae81ff>5</span>), use_indirect(false) {}
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Features that Apollo can use for tuning decisions
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>KernelFeatures</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>float</span> problem_size_log;     <span style=color:#75715e>// Log of problem size
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>float</span> memory_footprint;      <span style=color:#75715e>// Estimated memory footprint in MB
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>float</span> arithmetic_intensity;  <span style=color:#75715e>// Ops per byte
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>float</span> sparsity_level;        <span style=color:#75715e>// Sparsity of data (0-1)
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>float</span> access_pattern;        <span style=color:#75715e>// 0 for sequential, 1 for random
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    KernelFeatures()
</span></span><span style=display:flex><span>        <span style=color:#f92672>:</span> problem_size_log(<span style=color:#ae81ff>0</span>), memory_footprint(<span style=color:#ae81ff>0</span>),
</span></span><span style=display:flex><span>          arithmetic_intensity(<span style=color:#ae81ff>0</span>), sparsity_level(<span style=color:#ae81ff>0</span>), access_pattern(<span style=color:#ae81ff>0</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>float</span><span style=color:#f92672>&gt;</span> toVector() <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {problem_size_log, memory_footprint, arithmetic_intensity,
</span></span><span style=display:flex><span>                sparsity_level, access_pattern};
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Base class for kernels
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>KernelBase</span> {
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>virtual</span> <span style=color:#f92672>~</span>KernelBase() <span style=color:#f92672>=</span> <span style=color:#66d9ef>default</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getName</span>() <span style=color:#66d9ef>const</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>virtual</span> KernelFeatures <span style=color:#a6e22e>extractFeatures</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initialize</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cleanup</span>() <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Vector addition kernel: c = a + b
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>VectorAddKernel</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>public</span> KernelBase {
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> a;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> b;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> c;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> size;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    VectorAddKernel() <span style=color:#f92672>:</span> a(<span style=color:#66d9ef>nullptr</span>), b(<span style=color:#66d9ef>nullptr</span>), c(<span style=color:#66d9ef>nullptr</span>), size(<span style=color:#ae81ff>0</span>) {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>~</span>VectorAddKernel() { cleanup(); }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getName</span>() <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span> { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;VectorAdd&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initialize</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cleanup</span>() <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    KernelFeatures <span style=color:#a6e22e>extractFeatures</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> ExecPolicy<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> execute() {
</span></span><span style=display:flex><span>        RAJA<span style=color:#f92672>::</span>forall<span style=color:#f92672>&lt;</span>ExecPolicy<span style=color:#f92672>&gt;</span>(RAJA<span style=color:#f92672>::</span>RangeSegment(<span style=color:#ae81ff>0</span>, size),
</span></span><span style=display:flex><span>            [<span style=color:#f92672>=</span>] RAJA_DEVICE (<span style=color:#66d9ef>int</span> i) {
</span></span><span style=display:flex><span>                c[i] <span style=color:#f92672>=</span> a[i] <span style=color:#f92672>+</span> b[i];
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getResult</span>() { <span style=color:#66d9ef>return</span> c; }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// DAXPY kernel: y = alpha * x + y
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DaxpyKernel</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>public</span> KernelBase {
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> x;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> y;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> alpha;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> size;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    DaxpyKernel() <span style=color:#f92672>:</span> x(<span style=color:#66d9ef>nullptr</span>), y(<span style=color:#66d9ef>nullptr</span>), alpha(<span style=color:#ae81ff>2.0</span>), size(<span style=color:#ae81ff>0</span>) {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>~</span>DaxpyKernel() { cleanup(); }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getName</span>() <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span> { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;DAXPY&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initialize</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cleanup</span>() <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    KernelFeatures <span style=color:#a6e22e>extractFeatures</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> ExecPolicy<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> execute() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>double</span> a <span style=color:#f92672>=</span> alpha;
</span></span><span style=display:flex><span>        RAJA<span style=color:#f92672>::</span>forall<span style=color:#f92672>&lt;</span>ExecPolicy<span style=color:#f92672>&gt;</span>(RAJA<span style=color:#f92672>::</span>RangeSegment(<span style=color:#ae81ff>0</span>, size),
</span></span><span style=display:flex><span>            [<span style=color:#f92672>=</span>] RAJA_DEVICE (<span style=color:#66d9ef>int</span> i) {
</span></span><span style=display:flex><span>                y[i] <span style=color:#f92672>=</span> a <span style=color:#f92672>*</span> x[i] <span style=color:#f92672>+</span> y[i];
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getResult</span>() { <span style=color:#66d9ef>return</span> y; }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Matrix-vector multiplication: y = A * x
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MatVecKernel</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>public</span> KernelBase {
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> A;  <span style=color:#75715e>// Matrix in row-major format
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> x;  <span style=color:#75715e>// Input vector
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> y;  <span style=color:#75715e>// Output vector
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> rows;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> cols;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    MatVecKernel() <span style=color:#f92672>:</span> A(<span style=color:#66d9ef>nullptr</span>), x(<span style=color:#66d9ef>nullptr</span>), y(<span style=color:#66d9ef>nullptr</span>), rows(<span style=color:#ae81ff>0</span>), cols(<span style=color:#ae81ff>0</span>) {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>~</span>MatVecKernel() { cleanup(); }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getName</span>() <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span> { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;MatVec&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initialize</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cleanup</span>() <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    KernelFeatures <span style=color:#a6e22e>extractFeatures</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> ExecPolicy<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> execute() {
</span></span><span style=display:flex><span>        RAJA<span style=color:#f92672>::</span>forall<span style=color:#f92672>&lt;</span>ExecPolicy<span style=color:#f92672>&gt;</span>(RAJA<span style=color:#f92672>::</span>RangeSegment(<span style=color:#ae81ff>0</span>, rows),
</span></span><span style=display:flex><span>            [<span style=color:#f92672>=</span>] RAJA_DEVICE (<span style=color:#66d9ef>int</span> i) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>double</span> sum <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; j <span style=color:#f92672>&lt;</span> cols; <span style=color:#f92672>++</span>j) {
</span></span><span style=display:flex><span>                    sum <span style=color:#f92672>+=</span> A[i <span style=color:#f92672>*</span> cols <span style=color:#f92672>+</span> j] <span style=color:#f92672>*</span> x[j];
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                y[i] <span style=color:#f92672>=</span> sum;
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getResult</span>() { <span style=color:#66d9ef>return</span> y; }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 1D Stencil computation
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Stencil1DKernel</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>public</span> KernelBase {
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> input;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> output;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> weights;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> size;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> stencil_radius;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    Stencil1DKernel() <span style=color:#f92672>:</span> input(<span style=color:#66d9ef>nullptr</span>), output(<span style=color:#66d9ef>nullptr</span>), weights(<span style=color:#66d9ef>nullptr</span>),
</span></span><span style=display:flex><span>                        size(<span style=color:#ae81ff>0</span>), stencil_radius(<span style=color:#ae81ff>2</span>) {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>~</span>Stencil1DKernel() { cleanup(); }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getName</span>() <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span> { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Stencil1D&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initialize</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cleanup</span>() <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    KernelFeatures <span style=color:#a6e22e>extractFeatures</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> ExecPolicy<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> execute() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> radius <span style=color:#f92672>=</span> stencil_radius;
</span></span><span style=display:flex><span>        RAJA<span style=color:#f92672>::</span>forall<span style=color:#f92672>&lt;</span>ExecPolicy<span style=color:#f92672>&gt;</span>(RAJA<span style=color:#f92672>::</span>RangeSegment(radius, size <span style=color:#f92672>-</span> radius),
</span></span><span style=display:flex><span>            [<span style=color:#f92672>=</span>] RAJA_DEVICE (<span style=color:#66d9ef>int</span> i) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>double</span> sum <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> j <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>radius; j <span style=color:#f92672>&lt;=</span> radius; <span style=color:#f92672>++</span>j) {
</span></span><span style=display:flex><span>                    sum <span style=color:#f92672>+=</span> input[i <span style=color:#f92672>+</span> j] <span style=color:#f92672>*</span> weights[j <span style=color:#f92672>+</span> radius];
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                output[i] <span style=color:#f92672>=</span> sum;
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getResult</span>() { <span style=color:#66d9ef>return</span> output; }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Reduction kernel: sum all elements
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ReductionKernel</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>public</span> KernelBase {
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> data;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> size;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> result;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    ReductionKernel() <span style=color:#f92672>:</span> data(<span style=color:#66d9ef>nullptr</span>), size(<span style=color:#ae81ff>0</span>), result(<span style=color:#ae81ff>0.0</span>) {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>~</span>ReductionKernel() { cleanup(); }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getName</span>() <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span> { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Reduction&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initialize</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cleanup</span>() <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    KernelFeatures <span style=color:#a6e22e>extractFeatures</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> ExecPolicy<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> execute() {
</span></span><span style=display:flex><span>        RAJA<span style=color:#f92672>::</span>ReduceSum<span style=color:#f92672>&lt;</span>RAJA<span style=color:#f92672>::</span>seq_reduce, <span style=color:#66d9ef>double</span><span style=color:#f92672>&gt;</span> sum(<span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        RAJA<span style=color:#f92672>::</span>forall<span style=color:#f92672>&lt;</span>ExecPolicy<span style=color:#f92672>&gt;</span>(RAJA<span style=color:#f92672>::</span>RangeSegment(<span style=color:#ae81ff>0</span>, size),
</span></span><span style=display:flex><span>            [<span style=color:#f92672>=</span>] RAJA_DEVICE (<span style=color:#66d9ef>int</span> i) {
</span></span><span style=display:flex><span>                sum <span style=color:#f92672>+=</span> data[i];
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        result <span style=color:#f92672>=</span> sum.get();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> <span style=color:#a6e22e>getResult</span>() { <span style=color:#66d9ef>return</span> result; }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Sparse matrix-vector multiplication
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SpMVKernel</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>public</span> KernelBase {
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// CSR format
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> values;     <span style=color:#75715e>// Non-zero values
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span><span style=color:#f92672>*</span> col_indices;   <span style=color:#75715e>// Column indices
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span><span style=color:#f92672>*</span> row_ptr;       <span style=color:#75715e>// Row pointers
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> x;          <span style=color:#75715e>// Input vector
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> y;          <span style=color:#75715e>// Output vector
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> num_rows;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> num_nonzeros;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    SpMVKernel() <span style=color:#f92672>:</span> values(<span style=color:#66d9ef>nullptr</span>), col_indices(<span style=color:#66d9ef>nullptr</span>), row_ptr(<span style=color:#66d9ef>nullptr</span>),
</span></span><span style=display:flex><span>                   x(<span style=color:#66d9ef>nullptr</span>), y(<span style=color:#66d9ef>nullptr</span>), num_rows(<span style=color:#ae81ff>0</span>), num_nonzeros(<span style=color:#ae81ff>0</span>) {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>~</span>SpMVKernel() { cleanup(); }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getName</span>() <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span> { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;SpMV&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initialize</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cleanup</span>() <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    KernelFeatures <span style=color:#a6e22e>extractFeatures</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> ExecPolicy<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> execute() {
</span></span><span style=display:flex><span>        RAJA<span style=color:#f92672>::</span>forall<span style=color:#f92672>&lt;</span>ExecPolicy<span style=color:#f92672>&gt;</span>(RAJA<span style=color:#f92672>::</span>RangeSegment(<span style=color:#ae81ff>0</span>, num_rows),
</span></span><span style=display:flex><span>            [<span style=color:#f92672>=</span>] RAJA_DEVICE (<span style=color:#66d9ef>int</span> row) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>double</span> sum <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> idx <span style=color:#f92672>=</span> row_ptr[row]; idx <span style=color:#f92672>&lt;</span> row_ptr[row <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]; <span style=color:#f92672>++</span>idx) {
</span></span><span style=display:flex><span>                    sum <span style=color:#f92672>+=</span> values[idx] <span style=color:#f92672>*</span> x[col_indices[idx]];
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                y[row] <span style=color:#f92672>=</span> sum;
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getResult</span>() { <span style=color:#66d9ef>return</span> y; }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Indirect memory access kernel (gather-scatter pattern)
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>IndirectKernel</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>public</span> KernelBase {
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> src;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> dst;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span><span style=color:#f92672>*</span> indices;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> size;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    IndirectKernel() <span style=color:#f92672>:</span> src(<span style=color:#66d9ef>nullptr</span>), dst(<span style=color:#66d9ef>nullptr</span>), indices(<span style=color:#66d9ef>nullptr</span>), size(<span style=color:#ae81ff>0</span>) {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>~</span>IndirectKernel() { cleanup(); }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getName</span>() <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span> { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Indirect&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initialize</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cleanup</span>() <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>    KernelFeatures <span style=color:#a6e22e>extractFeatures</span>(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>override</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> ExecPolicy<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> execute() {
</span></span><span style=display:flex><span>        RAJA<span style=color:#f92672>::</span>forall<span style=color:#f92672>&lt;</span>ExecPolicy<span style=color:#f92672>&gt;</span>(RAJA<span style=color:#f92672>::</span>RangeSegment(<span style=color:#ae81ff>0</span>, size),
</span></span><span style=display:flex><span>            [<span style=color:#f92672>=</span>] RAJA_DEVICE (<span style=color:#66d9ef>int</span> i) {
</span></span><span style=display:flex><span>                dst[i] <span style=color:#f92672>=</span> src[indices[i]] <span style=color:#f92672>*</span> <span style=color:#ae81ff>2.0</span>;
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>getResult</span>() { <span style=color:#66d9ef>return</span> dst; }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Factory function to create kernels
</span></span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>unique_ptr<span style=color:#f92672>&lt;</span>KernelBase<span style=color:#f92672>&gt;</span> createKernel(<span style=color:#66d9ef>const</span> std<span style=color:#f92672>::</span>string<span style=color:#f92672>&amp;</span> kernel_name);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Utility functions
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initializeRandomData</span>(<span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> data, <span style=color:#66d9ef>int</span> size, <span style=color:#66d9ef>double</span> min_val <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>, <span style=color:#66d9ef>double</span> max_val <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initializeRandomIndices</span>(<span style=color:#66d9ef>int</span><span style=color:#f92672>*</span> indices, <span style=color:#66d9ef>int</span> size, <span style=color:#66d9ef>int</span> max_index);
</span></span><span style=display:flex><span><span style=color:#66d9ef>double</span> <span style=color:#a6e22e>computeChecksum</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> data, <span style=color:#66d9ef>int</span> size);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>} <span style=color:#75715e>// namespace apollo_demo
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#endif </span><span style=color:#75715e>// APOLLO_RAJA_DEMO_KERNELS_H
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#75715e>// kernels.cpp
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;kernels.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;cstring&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;random&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;algorithm&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;iostream&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> apollo_demo {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Utility functions implementation
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initializeRandomData</span>(<span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> data, <span style=color:#66d9ef>int</span> size, <span style=color:#66d9ef>double</span> min_val, <span style=color:#66d9ef>double</span> max_val) {
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>random_device rd;
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>mt19937 gen(rd());
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>uniform_real_distribution<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>double</span><span style=color:#f92672>&gt;</span> dist(min_val, max_val);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> size; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>        data[i] <span style=color:#f92672>=</span> dist(gen);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initializeRandomIndices</span>(<span style=color:#66d9ef>int</span><span style=color:#f92672>*</span> indices, <span style=color:#66d9ef>int</span> size, <span style=color:#66d9ef>int</span> max_index) {
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>random_device rd;
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>mt19937 gen(rd());
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>uniform_int_distribution<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span> dist(<span style=color:#ae81ff>0</span>, max_index <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> size; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>        indices[i] <span style=color:#f92672>=</span> dist(gen);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>double</span> <span style=color:#a6e22e>computeChecksum</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>double</span><span style=color:#f92672>*</span> data, <span style=color:#66d9ef>int</span> size) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> sum <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> size; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>        sum <span style=color:#f92672>+=</span> data[i];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sum;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// VectorAddKernel implementation
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> VectorAddKernel<span style=color:#f92672>::</span>initialize(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) {
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> config.size;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Allocate memory
</span></span></span><span style=display:flex><span>    a <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[size];
</span></span><span style=display:flex><span>    b <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[size];
</span></span><span style=display:flex><span>    c <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[size];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Initialize with random data
</span></span></span><span style=display:flex><span>    initializeRandomData(a, size, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    initializeRandomData(b, size, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>memset(c, <span style=color:#ae81ff>0</span>, size <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>));
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> VectorAddKernel<span style=color:#f92672>::</span>cleanup() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] a;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] b;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] c;
</span></span><span style=display:flex><span>    a <span style=color:#f92672>=</span> b <span style=color:#f92672>=</span> c <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>KernelFeatures VectorAddKernel<span style=color:#f92672>::</span>extractFeatures(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>    KernelFeatures features;
</span></span><span style=display:flex><span>    features.problem_size_log <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>log10(<span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>float</span><span style=color:#f92672>&gt;</span>(config.size));
</span></span><span style=display:flex><span>    features.memory_footprint <span style=color:#f92672>=</span> (<span style=color:#ae81ff>3.0f</span> <span style=color:#f92672>*</span> config.size <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>)) <span style=color:#f92672>/</span> (<span style=color:#ae81ff>1024.0f</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024.0f</span>); <span style=color:#75715e>// MB
</span></span></span><span style=display:flex><span>    features.arithmetic_intensity <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0f</span> <span style=color:#f92672>/</span> (<span style=color:#ae81ff>3.0f</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>)); <span style=color:#75715e>// 1 op per 3 memory accesses
</span></span></span><span style=display:flex><span>    features.sparsity_level <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0f</span>; <span style=color:#75715e>// Dense operation
</span></span></span><span style=display:flex><span>    features.access_pattern <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0f</span>; <span style=color:#75715e>// Sequential access
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> features;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// DaxpyKernel implementation
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> DaxpyKernel<span style=color:#f92672>::</span>initialize(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) {
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> config.size;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Allocate memory
</span></span></span><span style=display:flex><span>    x <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[size];
</span></span><span style=display:flex><span>    y <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[size];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Initialize with random data
</span></span></span><span style=display:flex><span>    initializeRandomData(x, size, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    initializeRandomData(y, size, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    alpha <span style=color:#f92672>=</span> <span style=color:#ae81ff>2.5</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> DaxpyKernel<span style=color:#f92672>::</span>cleanup() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] x;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] y;
</span></span><span style=display:flex><span>    x <span style=color:#f92672>=</span> y <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>KernelFeatures DaxpyKernel<span style=color:#f92672>::</span>extractFeatures(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>    KernelFeatures features;
</span></span><span style=display:flex><span>    features.problem_size_log <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>log10(<span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>float</span><span style=color:#f92672>&gt;</span>(config.size));
</span></span><span style=display:flex><span>    features.memory_footprint <span style=color:#f92672>=</span> (<span style=color:#ae81ff>2.0f</span> <span style=color:#f92672>*</span> config.size <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>)) <span style=color:#f92672>/</span> (<span style=color:#ae81ff>1024.0f</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024.0f</span>);
</span></span><span style=display:flex><span>    features.arithmetic_intensity <span style=color:#f92672>=</span> <span style=color:#ae81ff>2.0f</span> <span style=color:#f92672>/</span> (<span style=color:#ae81ff>3.0f</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>)); <span style=color:#75715e>// 2 ops per 3 memory accesses
</span></span></span><span style=display:flex><span>    features.sparsity_level <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0f</span>;
</span></span><span style=display:flex><span>    features.access_pattern <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0f</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> features;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// MatVecKernel implementation
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> MatVecKernel<span style=color:#f92672>::</span>initialize(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Make it a square matrix for simplicity
</span></span></span><span style=display:flex><span>    rows <span style=color:#f92672>=</span> <span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span>(std<span style=color:#f92672>::</span>sqrt(config.size));
</span></span><span style=display:flex><span>    cols <span style=color:#f92672>=</span> rows;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Allocate memory
</span></span></span><span style=display:flex><span>    A <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[rows <span style=color:#f92672>*</span> cols];
</span></span><span style=display:flex><span>    x <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[cols];
</span></span><span style=display:flex><span>    y <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[rows];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Initialize with random data
</span></span></span><span style=display:flex><span>    initializeRandomData(A, rows <span style=color:#f92672>*</span> cols, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    initializeRandomData(x, cols, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>memset(y, <span style=color:#ae81ff>0</span>, rows <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>));
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> MatVecKernel<span style=color:#f92672>::</span>cleanup() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] A;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] x;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] y;
</span></span><span style=display:flex><span>    A <span style=color:#f92672>=</span> x <span style=color:#f92672>=</span> y <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>    rows <span style=color:#f92672>=</span> cols <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>KernelFeatures MatVecKernel<span style=color:#f92672>::</span>extractFeatures(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>    KernelFeatures features;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> matrix_size <span style=color:#f92672>=</span> <span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span>(std<span style=color:#f92672>::</span>sqrt(config.size));
</span></span><span style=display:flex><span>    features.problem_size_log <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>log10(<span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>float</span><span style=color:#f92672>&gt;</span>(matrix_size <span style=color:#f92672>*</span> matrix_size));
</span></span><span style=display:flex><span>    features.memory_footprint <span style=color:#f92672>=</span> ((matrix_size <span style=color:#f92672>*</span> matrix_size <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> matrix_size) <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>)) <span style=color:#f92672>/</span> (<span style=color:#ae81ff>1024.0f</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024.0f</span>);
</span></span><span style=display:flex><span>    features.arithmetic_intensity <span style=color:#f92672>=</span> <span style=color:#ae81ff>2.0f</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>); <span style=color:#75715e>// 2 ops per memory access
</span></span></span><span style=display:flex><span>    features.sparsity_level <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0f</span>;
</span></span><span style=display:flex><span>    features.access_pattern <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.2f</span>; <span style=color:#75715e>// Some non-sequential due to matrix access
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> features;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Stencil1DKernel implementation
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> Stencil1DKernel<span style=color:#f92672>::</span>initialize(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) {
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> config.size;
</span></span><span style=display:flex><span>    stencil_radius <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>min(config.stencil_size <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>4</span>); <span style=color:#75715e>// Cap at 4 for safety
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Allocate memory
</span></span></span><span style=display:flex><span>    input <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[size];
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[size];
</span></span><span style=display:flex><span>    weights <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> stencil_radius <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Initialize with random data
</span></span></span><span style=display:flex><span>    initializeRandomData(input, size, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>memset(output, <span style=color:#ae81ff>0</span>, size <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Initialize stencil weights (normalized)
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> total_weight <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> stencil_radius <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>        weights[i] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> (std<span style=color:#f92672>::</span>abs(i <span style=color:#f92672>-</span> stencil_radius) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>        total_weight <span style=color:#f92672>+=</span> weights[i];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> stencil_radius <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>        weights[i] <span style=color:#f92672>/=</span> total_weight;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> Stencil1DKernel<span style=color:#f92672>::</span>cleanup() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] input;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] output;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] weights;
</span></span><span style=display:flex><span>    input <span style=color:#f92672>=</span> output <span style=color:#f92672>=</span> weights <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    stencil_radius <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>KernelFeatures Stencil1DKernel<span style=color:#f92672>::</span>extractFeatures(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>    KernelFeatures features;
</span></span><span style=display:flex><span>    features.problem_size_log <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>log10(<span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>float</span><span style=color:#f92672>&gt;</span>(config.size));
</span></span><span style=display:flex><span>    features.memory_footprint <span style=color:#f92672>=</span> (<span style=color:#ae81ff>2.0f</span> <span style=color:#f92672>*</span> config.size <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>)) <span style=color:#f92672>/</span> (<span style=color:#ae81ff>1024.0f</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024.0f</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> stencil_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> std<span style=color:#f92672>::</span>min(config.stencil_size <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>4</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    features.arithmetic_intensity <span style=color:#f92672>=</span> <span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>float</span><span style=color:#f92672>&gt;</span>(stencil_size) <span style=color:#f92672>/</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>);
</span></span><span style=display:flex><span>    features.sparsity_level <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0f</span>;
</span></span><span style=display:flex><span>    features.access_pattern <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.1f</span>; <span style=color:#75715e>// Mostly sequential with some locality
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> features;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ReductionKernel implementation
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> ReductionKernel<span style=color:#f92672>::</span>initialize(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) {
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> config.size;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Allocate memory
</span></span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[size];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Initialize with random data
</span></span></span><span style=display:flex><span>    initializeRandomData(data, size, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> ReductionKernel<span style=color:#f92672>::</span>cleanup() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] data;
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>KernelFeatures ReductionKernel<span style=color:#f92672>::</span>extractFeatures(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>    KernelFeatures features;
</span></span><span style=display:flex><span>    features.problem_size_log <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>log10(<span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>float</span><span style=color:#f92672>&gt;</span>(config.size));
</span></span><span style=display:flex><span>    features.memory_footprint <span style=color:#f92672>=</span> (config.size <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>)) <span style=color:#f92672>/</span> (<span style=color:#ae81ff>1024.0f</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024.0f</span>);
</span></span><span style=display:flex><span>    features.arithmetic_intensity <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0f</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>); <span style=color:#75715e>// 1 op per memory access
</span></span></span><span style=display:flex><span>    features.sparsity_level <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0f</span>;
</span></span><span style=display:flex><span>    features.access_pattern <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0f</span>; <span style=color:#75715e>// Pure sequential
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> features;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// SpMVKernel implementation
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> SpMVKernel<span style=color:#f92672>::</span>initialize(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) {
</span></span><span style=display:flex><span>    num_rows <span style=color:#f92672>=</span> <span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span>(std<span style=color:#f92672>::</span>sqrt(config.size));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> num_cols <span style=color:#f92672>=</span> num_rows;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Generate sparse matrix in CSR format
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// Number of non-zeros based on sparsity level
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> density <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>-</span> config.sparsity;
</span></span><span style=display:flex><span>    num_nonzeros <span style=color:#f92672>=</span> <span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span>(num_rows <span style=color:#f92672>*</span> num_cols <span style=color:#f92672>*</span> density);
</span></span><span style=display:flex><span>    num_nonzeros <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>max(num_rows, num_nonzeros); <span style=color:#75715e>// At least one per row
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Allocate memory
</span></span></span><span style=display:flex><span>    values <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[num_nonzeros];
</span></span><span style=display:flex><span>    col_indices <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span>[num_nonzeros];
</span></span><span style=display:flex><span>    row_ptr <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span>[num_rows <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>    x <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[num_cols];
</span></span><span style=display:flex><span>    y <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[num_rows];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Initialize sparse matrix
</span></span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>random_device rd;
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>mt19937 gen(rd());
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>uniform_real_distribution<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>double</span><span style=color:#f92672>&gt;</span> val_dist(<span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>uniform_int_distribution<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span> col_dist(<span style=color:#ae81ff>0</span>, num_cols <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> nnz_idx <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    row_ptr[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> row <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; row <span style=color:#f92672>&lt;</span> num_rows; <span style=color:#f92672>++</span>row) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> nnz_per_row <span style=color:#f92672>=</span> num_nonzeros <span style=color:#f92672>/</span> num_rows;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (row <span style=color:#f92672>&lt;</span> num_nonzeros <span style=color:#f92672>%</span> num_rows) nnz_per_row<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span> cols;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> nnz_per_row <span style=color:#f92672>&amp;&amp;</span> nnz_idx <span style=color:#f92672>&lt;</span> num_nonzeros; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>            cols.push_back(col_dist(gen));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        std<span style=color:#f92672>::</span>sort(cols.begin(), cols.end());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> col : cols) {
</span></span><span style=display:flex><span>            values[nnz_idx] <span style=color:#f92672>=</span> val_dist(gen);
</span></span><span style=display:flex><span>            col_indices[nnz_idx] <span style=color:#f92672>=</span> col;
</span></span><span style=display:flex><span>            nnz_idx<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        row_ptr[row <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> nnz_idx;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Initialize vectors
</span></span></span><span style=display:flex><span>    initializeRandomData(x, num_cols, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>memset(y, <span style=color:#ae81ff>0</span>, num_rows <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>));
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> SpMVKernel<span style=color:#f92672>::</span>cleanup() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] values;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] col_indices;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] row_ptr;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] x;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] y;
</span></span><span style=display:flex><span>    values <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>    col_indices <span style=color:#f92672>=</span> row_ptr <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>    x <span style=color:#f92672>=</span> y <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>    num_rows <span style=color:#f92672>=</span> num_nonzeros <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>KernelFeatures SpMVKernel<span style=color:#f92672>::</span>extractFeatures(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>    KernelFeatures features;
</span></span><span style=display:flex><span>    features.problem_size_log <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>log10(<span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>float</span><span style=color:#f92672>&gt;</span>(config.size));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>float</span> density <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0f</span> <span style=color:#f92672>-</span> config.sparsity;
</span></span><span style=display:flex><span>    features.memory_footprint <span style=color:#f92672>=</span> ((config.size <span style=color:#f92672>*</span> density <span style=color:#f92672>+</span> config.size) <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>)) <span style=color:#f92672>/</span> (<span style=color:#ae81ff>1024.0f</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024.0f</span>);
</span></span><span style=display:flex><span>    features.arithmetic_intensity <span style=color:#f92672>=</span> <span style=color:#ae81ff>2.0f</span> <span style=color:#f92672>/</span> (<span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>) <span style=color:#f92672>+</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>int</span>)); <span style=color:#75715e>// 2 ops per value+index access
</span></span></span><span style=display:flex><span>    features.sparsity_level <span style=color:#f92672>=</span> config.sparsity;
</span></span><span style=display:flex><span>    features.access_pattern <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.5f</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5f</span> <span style=color:#f92672>*</span> config.sparsity; <span style=color:#75715e>// More random with higher sparsity
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> features;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// IndirectKernel implementation
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> IndirectKernel<span style=color:#f92672>::</span>initialize(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) {
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> config.size;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Allocate memory
</span></span></span><span style=display:flex><span>    src <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[size];
</span></span><span style=display:flex><span>    dst <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>double</span>[size];
</span></span><span style=display:flex><span>    indices <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span>[size];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Initialize data
</span></span></span><span style=display:flex><span>    initializeRandomData(src, size, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>memset(dst, <span style=color:#ae81ff>0</span>, size <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Initialize indices
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (config.use_indirect) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Random access pattern
</span></span></span><span style=display:flex><span>        initializeRandomIndices(indices, size, size);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Sequential access pattern
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> size; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>            indices[i] <span style=color:#f92672>=</span> i;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> IndirectKernel<span style=color:#f92672>::</span>cleanup() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] src;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] dst;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>delete</span>[] indices;
</span></span><span style=display:flex><span>    src <span style=color:#f92672>=</span> dst <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>    indices <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>KernelFeatures IndirectKernel<span style=color:#f92672>::</span>extractFeatures(<span style=color:#66d9ef>const</span> ProblemConfig<span style=color:#f92672>&amp;</span> config) <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>    KernelFeatures features;
</span></span><span style=display:flex><span>    features.problem_size_log <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>log10(<span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>float</span><span style=color:#f92672>&gt;</span>(config.size));
</span></span><span style=display:flex><span>    features.memory_footprint <span style=color:#f92672>=</span> (<span style=color:#ae81ff>2.0f</span> <span style=color:#f92672>*</span> config.size <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>) <span style=color:#f92672>+</span> config.size <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>int</span>)) <span style=color:#f92672>/</span> (<span style=color:#ae81ff>1024.0f</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024.0f</span>);
</span></span><span style=display:flex><span>    features.arithmetic_intensity <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0f</span> <span style=color:#f92672>/</span> (<span style=color:#ae81ff>2.0f</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>double</span>) <span style=color:#f92672>+</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>int</span>));
</span></span><span style=display:flex><span>    features.sparsity_level <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0f</span>;
</span></span><span style=display:flex><span>    features.access_pattern <span style=color:#f92672>=</span> config.use_indirect <span style=color:#f92672>?</span> <span style=color:#ae81ff>1.0f</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0.0f</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> features;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Factory function
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>unique_ptr<span style=color:#f92672>&lt;</span>KernelBase<span style=color:#f92672>&gt;</span> createKernel(<span style=color:#66d9ef>const</span> std<span style=color:#f92672>::</span>string<span style=color:#f92672>&amp;</span> kernel_name) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (kernel_name <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;VectorAdd&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> std<span style=color:#f92672>::</span>make_unique<span style=color:#f92672>&lt;</span>VectorAddKernel<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (kernel_name <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;DAXPY&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> std<span style=color:#f92672>::</span>make_unique<span style=color:#f92672>&lt;</span>DaxpyKernel<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (kernel_name <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;MatVec&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> std<span style=color:#f92672>::</span>make_unique<span style=color:#f92672>&lt;</span>MatVecKernel<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (kernel_name <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Stencil1D&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> std<span style=color:#f92672>::</span>make_unique<span style=color:#f92672>&lt;</span>Stencil1DKernel<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (kernel_name <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Reduction&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> std<span style=color:#f92672>::</span>make_unique<span style=color:#f92672>&lt;</span>ReductionKernel<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (kernel_name <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;SpMV&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> std<span style=color:#f92672>::</span>make_unique<span style=color:#f92672>&lt;</span>SpMVKernel<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (kernel_name <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Indirect&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> std<span style=color:#f92672>::</span>make_unique<span style=color:#f92672>&lt;</span>IndirectKernel<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>} <span style=color:#75715e>// namespace apollo_demo
</span></span></span></code></pre></div><p>Reading through the Apollo documentation, I think this setup could be a lot less verbose if I were to use the Apollo-enabled RAJA fork from (<a href=https://github.com/LLNL/RAJA/compare/develop...ggeorgakoudis:RAJA:feature/apollo%29>https://github.com/LLNL/RAJA/compare/develop...ggeorgakoudis:RAJA:feature/apollo)</a>. But at this point that&rsquo;s an extremely old version of RAJA, and I don&rsquo;t really trust Claude to be able to cope with the older API and any important changes that might have happened since.</p><p>For the parameters that it chose by default, we don&rsquo;t really get anything exciting out of Apollo. It determines that for all of those kernels, with an input size of around 10^5 the fastest execution policy is just the serial one and that the OpenMP thread overhead isn&rsquo;t worth it. But if I increase the problem size by a factor of 100, it starts picking other OpenMP policies. It also really helps if I make sure my system isn&rsquo;t doing anything else at the time, as the OpenMP policies with explicit batch policies are the ones that suffer the most if other processes are taking resources:</p><pre tabindex=0><code>Command: APOLLO_POLICY_MODEL=&#39;DecisionTree,explore=RoundRobin,max_depth=4&#39; ./apollo_raja_demo_cpu --adaptive

Apollo-RAJA CPU Demonstration
==============================

Configuration:
  Number of policies: 5
  Available policies:
    0: Sequential
    1: OpenMP Default
    2: OpenMP Static-16
    3: OpenMP Dynamic-8
    4: OpenMP Guided
  OpenMP threads: 8
  Apollo Policy Model: DecisionTree,explore=RoundRobin,max_depth=4
== APOLLO: Looked for APOLLO_COLLECTIVE_TRAINING with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_LOCAL_TRAINING with getenv(), found nothing, using &#39;1&#39; (default) instead.
== APOLLO: Looked for APOLLO_SINGLE_MODEL with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_REGION_MODEL with getenv(), found nothing, using &#39;1&#39; (default) instead.
== APOLLO: Looked for APOLLO_GLOBAL_TRAIN_PERIOD with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_PER_REGION_TRAIN_PERIOD with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_TRACE_POLICY with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_STORE_MODELS with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_TRACE_RETRAIN with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_TRACE_ALLGATHER with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_TRACE_BEST_POLICIES with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_RETRAIN_ENABLE with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_RETRAIN_TIME_THRESHOLD with getenv(), found nothing, using &#39;2.0&#39; (default) instead.
== APOLLO: Looked for APOLLO_RETRAIN_REGION_THRESHOLD with getenv(), found nothing, using &#39;0.5&#39; (default) instead.
== APOLLO: Looked for APOLLO_TRACE_CSV with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_PERSISTENT_DATASETS with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_STORE_EXEC_INFO with getenv(), found nothing, using &#39;0&#39; (default) instead.
== APOLLO: Looked for APOLLO_OUTPUT_DIR with getenv(), found nothing, using &#39;.apollo&#39; (default) instead.
== APOLLO: Looked for APOLLO_DATASETS_DIR with getenv(), found nothing, using &#39;datasets&#39; (default) instead.
== APOLLO: Looked for APOLLO_TRACES_DIR with getenv(), found nothing, using &#39;traces&#39; (default) instead.
== APOLLO: Looked for APOLLO_MODELS_DIR with getenv(), found nothing, using &#39;models&#39; (default) instead.

============================================================
ADAPTIVE SCENARIO: Apollo learns optimal policies
============================================================

--- EXPLORATION PHASE ---
Apollo explores different policies...

=== Running VectorAdd Kernel ===
Problem size: 100000
Iterations: 5
  Apollo selected: Sequential (policy 0)
  Iteration  1: 0.032 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  2: 0.182 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  3: 0.173 ms
  Apollo selected: OpenMP Dynamic-8 (policy 3)
  Iteration  4: 0.799 ms
  Apollo selected: OpenMP Guided (policy 4)
  Iteration  5: 0.092 ms

Statistics:
  Average: 0.256 ms
  Min:     0.032 ms
  Max:     0.799 ms

=== Running DAXPY Kernel ===
Problem size: 100000
Iterations: 5
  Apollo selected: Sequential (policy 0)
  Iteration  1: 0.025 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  2: 0.054 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  3: 0.086 ms
  Apollo selected: OpenMP Dynamic-8 (policy 3)
  Iteration  4: 0.126 ms
  Apollo selected: OpenMP Guided (policy 4)
  Iteration  5: 0.124 ms

Statistics:
  Average: 0.083 ms
  Min:     0.025 ms
  Max:     0.126 ms

=== Running Stencil1D Kernel ===
Problem size: 100000
Iterations: 5
  Apollo selected: Sequential (policy 0)
  Iteration  1: 0.132 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  2: 0.131 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  3: 0.145 ms
  Apollo selected: OpenMP Dynamic-8 (policy 3)
  Iteration  4: 0.172 ms
  Apollo selected: OpenMP Guided (policy 4)
  Iteration  5: 0.140 ms

Statistics:
  Average: 0.144 ms
  Min:     0.131 ms
  Max:     0.172 ms

=== Running Reduction Kernel ===
Problem size: 100000
Iterations: 5
  Apollo selected: Sequential (policy 0)
  Iteration  1: 0.100 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  2: 0.086 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  3: 0.077 ms
  Apollo selected: OpenMP Dynamic-8 (policy 3)
  Iteration  4: 0.129 ms
  Apollo selected: OpenMP Guided (policy 4)
  Iteration  5: 0.102 ms

Statistics:
  Average: 0.099 ms
  Min:     0.077 ms
  Max:     0.129 ms

=== Running VectorAdd Kernel ===
Problem size: 1000000
Iterations: 5
  Apollo selected: Sequential (policy 0)
  Iteration  1: 1.090 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  2: 0.569 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  3: 1.090 ms
  Apollo selected: OpenMP Dynamic-8 (policy 3)
  Iteration  4: 0.679 ms
  Apollo selected: OpenMP Guided (policy 4)
  Iteration  5: 0.522 ms

Statistics:
  Average: 0.790 ms
  Min:     0.522 ms
  Max:     1.090 ms

=== Running DAXPY Kernel ===
Problem size: 1000000
Iterations: 5
  Apollo selected: Sequential (policy 0)
  Iteration  1: 1.183 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  2: 0.459 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  3: 0.733 ms
  Apollo selected: OpenMP Dynamic-8 (policy 3)
  Iteration  4: 0.709 ms
  Apollo selected: OpenMP Guided (policy 4)
  Iteration  5: 0.369 ms

Statistics:
  Average: 0.691 ms
  Min:     0.369 ms
  Max:     1.183 ms

=== Running Stencil1D Kernel ===
Problem size: 1000000
Iterations: 5
  Apollo selected: Sequential (policy 0)
  Iteration  1: 1.275 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  2: 0.764 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  3: 0.950 ms
  Apollo selected: OpenMP Dynamic-8 (policy 3)
  Iteration  4: 0.965 ms
  Apollo selected: OpenMP Guided (policy 4)
  Iteration  5: 0.618 ms

Statistics:
  Average: 0.914 ms
  Min:     0.618 ms
  Max:     1.275 ms

=== Running Reduction Kernel ===
Problem size: 1000000
Iterations: 5
  Apollo selected: Sequential (policy 0)
  Iteration  1: 0.983 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  2: 0.416 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  3: 0.385 ms
  Apollo selected: OpenMP Dynamic-8 (policy 3)
  Iteration  4: 0.616 ms
  Apollo selected: OpenMP Guided (policy 4)
  Iteration  5: 0.305 ms

Statistics:
  Average: 0.541 ms
  Min:     0.305 ms
  Max:     0.983 ms

--- TRAINING PHASE ---
Apollo has trained models based on exploration data

--- EXPLOITATION PHASE ---
Apollo uses learned models to select optimal policies...

=== Running VectorAdd Kernel ===
Problem size: 10000000
Iterations: 5
  Apollo selected: Sequential (policy 0)
  Iteration  1: 18.672 ms
  Apollo selected: Sequential (policy 0)
  Iteration  2: 5.530 ms
  Apollo selected: Sequential (policy 0)
  Iteration  3: 5.048 ms
  Apollo selected: Sequential (policy 0)
  Iteration  4: 5.151 ms
  Apollo selected: Sequential (policy 0)
  Iteration  5: 5.259 ms

Statistics:
  Average: 7.932 ms
  Min:     5.048 ms
  Max:     18.672 ms

=== Running DAXPY Kernel ===
Problem size: 10000000
Iterations: 5
  Apollo selected: Sequential (policy 0)
  Iteration  1: 4.582 ms
  Apollo selected: Sequential (policy 0)
  Iteration  2: 4.827 ms
  Apollo selected: Sequential (policy 0)
  Iteration  3: 4.528 ms
  Apollo selected: Sequential (policy 0)
  Iteration  4: 4.759 ms
  Apollo selected: Sequential (policy 0)
  Iteration  5: 4.752 ms

Statistics:
  Average: 4.690 ms
  Min:     4.528 ms
  Max:     4.827 ms

=== Running Stencil1D Kernel ===
Problem size: 10000000
Iterations: 5
  Apollo selected: OpenMP Default (policy 1)
  Iteration  1: 5.894 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  2: 6.527 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  3: 6.348 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  4: 6.901 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  5: 6.106 ms

Statistics:
  Average: 6.355 ms
  Min:     5.894 ms
  Max:     6.901 ms

=== Running Reduction Kernel ===
Problem size: 10000000
Iterations: 5
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  1: 3.036 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  2: 2.883 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  3: 3.074 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  4: 2.620 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  5: 2.647 ms


Statistics:
  Average: 2.852 ms
  Min:     2.620 ms
  Max:     3.074 ms

=== Running VectorAdd Kernel ===
Problem size: 100000000
Iterations: 5
  Apollo selected: Sequential (policy 0)
  Iteration  1: 526.750 ms
  Apollo selected: Sequential (policy 0)
  Iteration  2: 84.982 ms
  Apollo selected: Sequential (policy 0)
  Iteration  3: 48.321 ms
  Apollo selected: Sequential (policy 0)
  Iteration  4: 59.781 ms
  Apollo selected: Sequential (policy 0)
  Iteration  5: 751.197 ms

Statistics:
  Average: 294.206 ms
  Min:     48.321 ms
  Max:     751.197 ms

=== Running DAXPY Kernel ===
Problem size: 100000000
Iterations: 5
  Apollo selected: Sequential (policy 0)
  Iteration  1: 81.666 ms
  Apollo selected: Sequential (policy 0)
  Iteration  2: 72.213 ms
  Apollo selected: Sequential (policy 0)
  Iteration  3: 46.080 ms
  Apollo selected: Sequential (policy 0)
  Iteration  4: 43.956 ms
  Apollo selected: Sequential (policy 0)
  Iteration  5: 44.062 ms

Statistics:
  Average: 57.595 ms
  Min:     43.956 ms
  Max:     81.666 ms

=== Running Stencil1D Kernel ===
Problem size: 100000000
Iterations: 5
  Apollo selected: OpenMP Default (policy 1)
  Iteration  1: 63.077 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  2: 52.470 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  3: 52.742 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  4: 52.084 ms
  Apollo selected: OpenMP Default (policy 1)
  Iteration  5: 53.496 ms

Statistics:
  Average: 54.774 ms
  Min:     52.084 ms
  Max:     63.077 ms

=== Running Reduction Kernel ===
Problem size: 100000000
Iterations: 5
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  1: 41.429 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  2: 25.145 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  3: 25.065 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  4: 24.666 ms
  Apollo selected: OpenMP Static-16 (policy 2)
  Iteration  5: 25.017 ms

Statistics:
  Average: 28.264 ms
  Min:     24.666 ms
  Max:     41.429 ms</code></pre><p>So overall pretty interesting! In the state the project is currently in, it is not at all obvious to me how I would use it in a codebase that isn&rsquo;t already structured around RAJA execution policies.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/r/notes/research/ class="flex align-center"><img src=/r/icons/backward.svg class=book-icon alt=Backward>
<span>Research Notes</span>
</a></span><span><a href=/r/notes/research/dgh-datta/ class="flex align-center"><span>Electrodynamic Dory-Guest-Harris Instability</span>
<img src=/r/icons/forward.svg class=book-icon alt=Forward></a></span></div><div class=book-comments></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div></main></body></html>